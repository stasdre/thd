/* eslint-disable */

/*!
 * Doka 3.1.0
 * Copyright 2019 PQINA Inc - All Rights Reserved
 * Please visit https://pqina.nl/doka/ for further information
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Doka=e():t.Doka=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(t,e){return e.parentNode.insertBefore(t,e)},o=function(t,e){return e.parentNode.insertBefore(t,e.nextSibling)};function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){a(t,e,n[e])})}return t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t,e,n){"function"!=typeof n?Object.defineProperty(t,e,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){c(t,e,n[e])})}return t}({},n)):t[e]=n},l=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},s=function(t){var e={};return l(t,function(n){u(e,n,t[n])}),e},f=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===n)return t.getAttribute(e)||t.hasAttribute(e);t.setAttribute(e,n)};function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var d=["svg","path"],h=function(t){return d.includes(t)};function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){m(t,e,n[e])})}return t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var g=function(t,e,n,r){var o=n[0]||t.left,i=n[1]||t.top,a=o+t.width,c=i+t.height*(r[1]||1),u={element:y({},t),inner:{left:t.left,top:t.top,right:t.right,bottom:t.bottom},outer:{left:o,top:i,right:a,bottom:c}};return e.filter(function(t){return!t.isRectIgnored()}).map(function(t){return t.rect}).forEach(function(t){v(u.inner,y({},t.inner)),v(u.outer,y({},t.outer))}),E(u.inner),u.outer.bottom+=u.element.marginBottom,u.outer.right+=u.element.marginRight,E(u.outer),u},v=function(t,e){e.top+=t.top,e.right+=t.left,e.bottom+=t.top,e.left+=t.left,e.bottom>t.bottom&&(t.bottom=e.bottom),e.right>t.right&&(t.right=e.right)},E=function(t){t.width=t.right-t.left,t.height=t.bottom-t.top},w=function(t){return"number"==typeof t},_=function(t){return t<.5?2*t*t:(4-2*t)*t-1};function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var x={spring:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.stiffness,n=void 0===e?.5:e,r=t.damping,o=void 0===r?.75:r,i=t.mass,a=void 0===i?10:i,c=null,u=null,l=0,f=!1,p=s({interpolate:function(){if(!f){if(!w(c)||!w(u))return f=!0,void(l=0);!function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;return Math.abs(t-e)<r&&Math.abs(n)<r}(u+=l+=-(u-c)*n/a,c,l*=o)?p.onupdate(u):(u=c,l=0,f=!0,p.onupdate(u),p.oncomplete(u))}},target:{set:function(t){if(w(t)&&!w(u)&&(u=t),null===c&&(c=t,u=t),u===(c=t)||void 0===c)return f=!0,l=0,p.onupdate(u),void p.oncomplete(u);f=!1},get:function(){return c}},resting:{get:function(){return f}},onupdate:function(t){},oncomplete:function(t){}});return p},tween:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.duration,o=void 0===r?500:r,i=n.easing,a=void 0===i?_:i,c=n.delay,u=void 0===c?0:c,l=null,f=!0,p=!1,d=null,h=s({interpolate:function(n){f||null===d||(null===l&&(l=n),n-l<u||((t=n-l-u)<o?(e=t/o,h.onupdate((t>=0?a(p?1-e:e):0)*d)):(t=1,e=p?0:1,h.onupdate(e*d),h.oncomplete(e*d),f=!0)))},target:{get:function(){return p?0:d},set:function(t){if(null===d)return d=t,h.onupdate(t),void h.oncomplete(t);t<d?(d=1,p=!0):(p=!1,d=t),f=!1,l=null}},resting:{get:function(){return f}},onupdate:function(t){},oncomplete:function(t){}});return h}},R=function(t,e,n){var r=t[e]&&"object"===O(t[e][n])?t[e][n]:t[e]||t,o="string"==typeof r?r:r.type,i="object"===O(r)?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){b(t,e,n[e])})}return t}({},r):{};return x[o]?x[o](i):null};function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var A=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(e=Array.isArray(e)?e:[e]).forEach(function(e){t.forEach(function(t){var o=t,i=function(){return n[t]},a=function(e){return n[t]=e};"object"===T(t)&&(o=t.key,i=t.getter||i,a=t.setter||a),e[o]&&!r||(e[o]={get:i,set:a})})})},I=function(t){return null!=t};function P(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){C(t,e,n[e])})}return t}function C(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var S={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},D=function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!0;for(var n in e)if(e[n]!==t[n])return!0;return!1},L=function(t,e){var n=e.opacity,r=e.perspective,o=e.translateX,i=e.translateY,a=e.scaleX,c=e.scaleY,u=e.rotateX,l=e.rotateY,s=e.rotateZ,f=e.originX,p=e.originY,d=e.width,h=e.height,y="",m="";(I(f)||I(p))&&(m+="transform-origin: ".concat(f||0,"px ").concat(p||0,"px;")),I(r)&&(y+="perspective(".concat(r,"px) ")),(I(o)||I(i))&&(y+="translate3d(".concat(o||0,"px, ").concat(i||0,"px, 0) ")),(I(a)||I(c))&&(y+="scale3d(".concat(I(a)?a:1,", ").concat(I(c)?c:1,", 1) ")),I(s)&&(y+="rotateZ(".concat(s,"rad) ")),I(u)&&(y+="rotateX(".concat(u,"rad) ")),I(l)&&(y+="rotateY(".concat(l,"rad) ")),y.length&&(m+="transform:".concat(y,";")),I(n)&&(m+="opacity:".concat(n,";"),0===n&&"BUTTON"===t.nodeName&&(m+="visibility:hidden;"),n<1&&(m+="pointer-events:none;")),I(h)&&(m+="height:".concat(h,"px;")),I(d)&&(m+="width:".concat(d,"px;"));var g=t.elementCurrentStyle||"";m.length===g.length&&m===g||(t.setAttribute("style",m),t.elementCurrentStyle=m)},G={styles:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,o=t.viewExternalAPI,i=t.view,a=M({},n),c={};A(e,[r,o],n);var u=function(){return i.rect?g(i.rect,i.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return r.rect={get:u},o.rect={get:u},e.forEach(function(t){n[t]=void 0===a[t]?S[t]:a[t]}),{write:function(){if(D(c,n))return L(i.element,n),Object.assign(c,M({},n)),!0},destroy:function(){}}},listeners:function(t){t.mixinConfig,t.viewProps,t.viewInternalAPI;var e=t.viewExternalAPI,n=(t.viewState,t.view),r=[],o=function(t){return function(e,n){t.addEventListener(e,n)}}(n.element),i=function(t){return function(e,n){t.removeEventListener(e,n)}}(n.element);return e.on=function(t,e){r.push({type:t,fn:e}),o(t,e)},e.off=function(t,e){r.splice(r.findIndex(function(n){return n.type===t&&n.fn===e}),1),i(t,e)},{write:function(){return!0},destroy:function(){r.forEach(function(t){i(t.type,t.fn)})}}},animations:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,o=t.viewExternalAPI,i=(t.viewState,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){P(t,e,n[e])})}return t}({},n)),a=[];return l(e,function(t,e){var c=R(e);c&&(c.onupdate=function(e){n[t]=e},c.target=i[t],A([{key:t,setter:function(t){c.target!==t&&(c.target=t)},getter:function(){return n[t]}}],[r,o],n,!0),a.push(c))}),{write:function(t){var e=!0;return a.forEach(function(n){n.resting||(e=!1),n.interpolate(t)}),e},destroy:function(){}}},apis:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewExternalAPI;A(e,r,n)}},U=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.layoutCalculated||(t.paddingTop=parseInt(n.paddingTop,10)||0,t.marginTop=parseInt(n.marginTop,10)||0,t.marginRight=parseInt(n.marginRight,10)||0,t.marginBottom=parseInt(n.marginBottom,10)||0,t.marginLeft=parseInt(n.marginLeft,10)||0,e.layoutCalculated=!0),t.left=e.offsetLeft||0,t.top=e.offsetTop||0,t.width=e.offsetWidth||0,t.height=e.offsetHeight||0,t.right=t.left+t.width,t.bottom=t.top+t.height,t.scrollTop=e.scrollTop,t.hidden=null===e.offsetParent&&"fixed"!==n.position,t};function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){k(t,e,n[e])})}return t}function k(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var V=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tag,n=void 0===e?"div":e,r=t.name,o=void 0===r?null:r,i=t.attributes,a=void 0===i?{}:i,c=t.read,u=void 0===c?function(){}:c,d=t.write,y=void 0===d?function(){}:d,m=t.create,v=void 0===m?function(){}:m,E=t.destroy,w=void 0===E?function(){}:E,_=t.filterFrameActionsForChild,b=void 0===_?function(t,e){return e}:_,O=t.didCreateView,x=void 0===O?function(){}:O,R=t.didWriteView,T=void 0===R?function(){}:R,A=t.ignoreRect,I=void 0!==A&&A,P=t.ignoreRectUpdate,M=void 0!==P&&P,C=t.mixins,S=void 0===C?[]:C;return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===p(e)&&(n=e,e=null);var r=h(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);return e&&(h(t)?f(r,"class",e):r.className=e),l(n,function(t,e){f(r,t,e)}),r}(n,o?"doka--".concat(o):null,a),i=window.getComputedStyle(r,null),c=U(),d=null,m=!1,E=[],_=[],O={},R={},A=[y],P=[u],C=[w],D=function(){return r},L=function(){return E.concat()},k=function(){return d||(d=g(c,E,[0,0],[1,1]))},V=function(){return r.layoutCalculated=!1},N={element:{get:D},style:{get:function(){return i}},childViews:{get:L}},Y=j({},N,{rect:{get:k},ref:{get:function(){return O}},is:function(t){return o===t},appendChild:function(t){return function(e,n){void 0!==n&&t.children[n]?t.insertBefore(e,t.children[n]):t.appendChild(e)}}(r),createChildView:function(t){return function(e,n){return e(t,n)}}(t),linkView:function(t){return E.push(t),t},unlinkView:function(t){E.splice(E.indexOf(t),1)},appendChildView:function(t,e){return function(t,n){return void 0!==n?e.splice(n,0,t):e.push(t),t}}(0,E),removeChildView:function(t,e){return function(n){return e.splice(e.indexOf(n),1),n.element.parentNode&&t.removeChild(n.element),n}}(r,E),registerWriter:function(t){return A.push(t)},registerReader:function(t){return P.push(t)},registerDestroyer:function(t){return C.push(t)},invalidateLayout:V,dispatch:t.dispatch,query:t.query}),B={element:{get:D},childViews:{get:L},rect:{get:k},resting:{get:function(){return m}},isRectIgnored:function(){return I},invalidateLayout:V,_read:function(){d=null,E.forEach(function(t){return t._read()}),!(M&&c.width&&c.height)&&U(c,r,i);var t={root:X,props:e,rect:c};P.forEach(function(e){return e(t)})},_write:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=0===n.length;return A.forEach(function(o){!1===o({props:e,root:X,actions:n,timestamp:t})&&(r=!1)}),_.forEach(function(e){!1===e.write(t)&&(r=!1)}),E.filter(function(t){return!!t.element.parentNode}).forEach(function(e){e._write(t,b(e,n))||(r=!1)}),E.forEach(function(e,o){e.element.parentNode||(X.appendChild(e.element,o),e._read(),e._write(t,b(e,n)),r=!1)}),m=r,T({props:e,root:X,actions:n,timestamp:t}),r},_destroy:function(){_.forEach(function(t){return t.destroy()}),C.forEach(function(t){t({root:X})}),E.forEach(function(t){return t._destroy()})}},z=j({},N,{rect:{get:function(){return c}}});Object.keys(S).sort(function(t,e){return"styles"===t?1:"styles"===e?-1:0}).forEach(function(t){var n=G[t]({mixinConfig:S[t],viewProps:e,viewState:R,viewInternalAPI:Y,viewExternalAPI:B,view:s(z)});n&&_.push(n)});var X=s(Y);v({root:X,props:e});var q=(r.children||[]).length;return E.forEach(function(t,e){X.appendChild(t.element,q+e)}),x(X),s(B)}},N=function(t,e){return function(n){var r=n.root,o=n.props,i=n.actions,a=void 0===i?[]:i,c=n.timestamp;a.filter(function(e){return t[e.type]}).forEach(function(e){return t[e.type]({root:r,props:o,action:e.data,timestamp:c})}),e&&e({root:r,props:o,actions:a,timestamp:c})}},Y=function(t){return Array.isArray(t)},B=function(t){return null==t},z=function(t){return t.trim()},X=function(t){return""+t},q=function(t){return"boolean"==typeof t},Z=function(t){return"string"==typeof t},F=function(t){return w(t)?t:Z(t)?X(t).replace(/[a-z]+/gi,""):0},H=function(t){return parseInt(F(t),10)},W=function(t){return w(t)&&isFinite(t)&&Math.floor(t)===t},Q=function(t){if(W(t))return t;var e=X(t).trim();return/MB$/i.test(e)?(e=e.replace(/MB$i/,"").trim(),1e3*H(e)*1e3):/KB/i.test(e)?(e=e.replace(/KB$i/,"").trim(),1e3*H(e)):H(e)};function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var J=function(t){return Y(t)?"array":function(t){return null===t}(t)?"null":W(t)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(t)?"bytes":K(t)},$={array:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return B(t)?[]:Y(t)?t:X(t).split(e).map(z).filter(function(t){return t.length})},boolean:function(t){return q(t)?t:"true"===t},int:function(t){return"bytes"===J(t)?Q(t):H(t)},float:function(t){return parseFloat(F(t))},bytes:Q,string:function(t){return function(t){return"function"==typeof t}(t)?t:X(t)},object:function(t){try{return JSON.parse(function(t){return t.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",')}(t))}catch(e){return t}},file:function(t){return t},function:function(t){return function(t){for(var e=self,n=t.split("."),r=null;r=n.shift();)if(!(e=e[r]))return null;return e}(t)}},tt=function(t,e,n){if(t===e)return t;var r=J(t);if(r!==n){var o=function(t,e){return $[e](t)}(t,n);if(r=J(o),null===o)throw'Trying to assign value with incorrect type to "'.concat(option,'", allowed type: "').concat(n,'"');t=o}return t},et=function(t){var e={};return l(t,function(n){var r=t[n];e[n]=function(t,e){var n=t;return{enumerable:!0,get:function(){return n},set:function(r){n=tt(r,t,e)}}}(r[0],r[1])}),s(e)},nt=function(t){t.file=null,t.rootRect=null,t.stage=null,t.image=null,t.zoomTimeoutId=null,t.instantUpdate=!1,t.filePromise=null,t.fileLoader=null,t.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,instructions:null,draft:{rectangle:null,transforms:null}}},rt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(/(?=[A-Z])/).map(function(t){return t.toLowerCase()}).join(e)},ot=function(){return Math.random().toString(36).substr(2,9)},it=function(){var t=[],e=function(e,n){!function(t,e){t.splice(e,1)}(t,t.findIndex(function(t){return t.event===e&&(t.cb===n||!n)}))};return{fire:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];t.filter(function(t){return t.event===e}).map(function(t){return t.cb}).forEach(function(t){setTimeout(function(){t.apply(void 0,r)},0)})},on:function(e,n){t.push({event:e,cb:n})},onOnce:function(n,r){t.push({event:n,cb:function(){e(n,r),r.apply(void 0,arguments)}})},off:e}},at="boolean",ct="int",ut="string",lt="array",st="object",ft="function",pt="file",dt="undefined"!=typeof window&&void 0!==window.document,ht=function(){return dt};function yt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var mt=function(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){yt(t,e,n[e])})}return t}({},gt)},gt={id:[null,ut],className:[null,ut],src:[null,pt],maxImagePreviewWidth:[1500,ct],maxImagePreviewHeight:[1500,ct],allowButtonCancel:[!0,at],allowButtonConfirm:[!0,at],allowDropFiles:[!1,at],allowAutoClose:[!0,at],allowAutoDestroy:[!1,at],outputData:[!1,at],outputFile:[!0,at],outputWidth:[null,ct],outputHeight:[null,ct],outputFit:["cover",ut],outputUpscale:[!0,at],outputStripImageHead:[!0,at],outputType:[null,ut],outputQuality:[null,ct],crop:[null,st],cropZoomTimeout:[null,ct],cropMask:[null,ft],cropMaskInset:[0,ct],cropAllowImageTurnRight:[!1,at],cropResizeKeyCodes:[[18,91,92,93],lt],cropAspectRatio:[null,ut],cropAspectRatioOptions:[null,lt],cropMinImageWidth:[0,ct],cropMinImageHeight:[0,ct],beforeCreateBlob:[null,ft],onconfirm:[null,ft],oncancel:[null,ft],onclose:[null,ft],onload:[null,ft],oninit:[null,ft],ondestroy:[null,ft],labelButtonReset:["Reset",ut],labelButtonCancel:["Cancel",ut],labelButtonConfirm:["Done",ut],labelStatusAwaitingImage:["Waiting for image…",ut],labelStatusLoadImageError:["Error loading image…",ut],labelStatusLoadingImage:["Loading image…",ut],labelStatusProcessingImage:["Processing image…",ut],labelButtonCropZoom:["Zoom",ut],labelButtonCropRotateLeft:["Rotate left",ut],labelButtonCropRotateRight:["Rotate right",ut],labelButtonCropRotateCenter:["Center rotation",ut],labelButtonCropFlipHorizontal:["Flip horizontal",ut],labelButtonCropFlipVertical:["Flip vertical",ut],labelButtonCropAspectRatio:["Aspect ratio",ut],styleFullscreenSafeArea:[ht()&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",ut],styleLayoutMode:[null,ut]},vt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},Et=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return parseFloat(t.toFixed(e))},wt=function(t,e){return{x:Et(t.x,e),y:Et(t.y,e)}},_t=function(t,e){return Rt(t.x-e.x,t.y-e.y)},bt=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(_t(t,e),_t(t,e))}(t,e))},Ot=function(t,e){return Rt(vt(t.x,e.x,e.x+e.width),vt(t.y,e.y,e.y+e.height))},xt=function(t,e,n){var r=Math.cos(e),o=Math.sin(e),i=Rt(t.x-n.x,t.y-n.y);return Rt(n.x+r*i.x-o*i.y,n.y+o*i.x+r*i.y)},Rt=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},Tt=function(t,e,n){return Lt(e*(t.x-n.x)+n.x,e*(t.y-n.y)+n.y,e*t.width,e*t.height)},At=function(t,e){return Lt(t.x+e.x,t.y+e.y,t.width,t.height)},It={translate:At,rotate:function(t,e,n){var r=function(t,e,n){return 0===e?{tl:t.tl,tr:t.tr,br:t.br,bl:t.bl}:{tl:xt(t.tl,e,n),tr:xt(t.tr,e,n),br:xt(t.br,e,n),bl:xt(t.bl,e,n)}}(Dt(t),e,n),o=r.tl,i=r.tr,a=r.br,c=r.bl,u=Math.min(o.x,i.x,a.x,c.x),l=Math.min(o.y,i.y,a.y,c.y),s=Math.max(o.x,i.x,a.x,c.x),f=Math.max(o.y,i.y,a.y,c.y);return Lt(u,l,s-u,f-l)},scale:Tt},Pt=function(t){return Lt(t.x,t.y,t.width,t.height)},Mt=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},Ct=function(t){var e=t.top,n=t.right,r=t.bottom,o=t.left;return{x:o,y:e,width:n-o,height:r-e}},St=function(t){return Rt(t.x+.5*t.width,t.y+.5*t.height)},Dt=function(t){return{tl:{x:t.x,y:t.y},tr:{x:t.x+t.width,y:t.y},br:{x:t.x+t.width,y:t.y+t.height},bl:{x:t.x,y:t.y+t.height}}},Lt=function(t,e,n,r){return{x:t,y:e,width:n,height:r}},Gt=function(t){if(B(t))return t;if(/:/.test(t)){var e=t.split(":"),n=e[0];return e[1]/n}return parseFloat(t)};function Ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){jt(t,e,n[e])})}return t}function jt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var kt=[],Vt=function(t){return t.crop.draft.transforms?t.crop.draft.transforms.scale:t.crop.transforms.scale},Nt=function(t){return{GET_STYLES:function(){return Object.keys(t.options).filter(function(t){return/^style/.test(t)}).map(function(e){return{name:e,value:t.options[e]}})},GET_FILE:function(){return t.file},GET_IMAGE:function(){return t.image},GET_STAGE:function(){return t.stage},GET_ROOT:function(){return t.root},GET_MIN_IMAGE_SIZE:function(){return{width:t.options.cropMinImageWidth,height:t.options.cropMinImageHeight}},GET_MIN_PREVIEW_IMAGE_SIZE:function(){var e=t.image.width/t.image.naturalWidth;return{width:t.options.cropMinImageWidth*e,height:t.options.cropMinImageHeight*e}},GET_MIN_CROP_SIZE:function(){return function(t){var e=t.image.width/t.image.naturalWidth,n=Vt(t);return{width:t.options.cropMinImageWidth*n*e,height:t.options.cropMinImageHeight*n*e}}(t)},GET_MAX_CROP_SIZE:function(){return function(t){var e=Vt(t);return{width:t.image.width*e,height:t.image.height*e}}(t)},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return t.options.cropAspectRatioOptions?t.options.cropAspectRatioOptions.map(function(t){return{label:t.label,value:t.value?Gt(t.value):null}}):null},GET_CROP_ASPECT_RATIO:function(){var e=null==t.crop.aspectRatio?t.options.cropAspectRatio:t.crop.aspectRatio;return Gt(e)},GET_ACTIVE_CROP_ASPECT_RATIO:function(){return t.crop.aspectRatio},GET_CROP_FLIP:function(){return t.crop.flip?Ut({},t.crop.flip):Ut({},t.crop.instructions.flip)},GET_CROP_ROTATION:function(){return Ut({},t.crop.rotation)},GET_CROP:function(e,n){var r=n+"",o=kt[e]?kt[e][r]:null;if(o)return o;kt[e]||(kt[e]=[]);var i=Bt(t);return kt[e][r]=i,i}}},Yt=function(t,e){var n=St(e);return!function(t,e){return Et(t.x)===Et(e.x)&&Et(t.y)===Et(e.y)}(St(t),n)},Bt=function(t){if(!t.stage||!t.image)return null;var e=t.crop.draft.rectangle||{free:t.crop.rectangle,limited:t.crop.rectangle},n=t.crop.draft.transforms||t.crop.transforms,r=n.origin,o=n.translation,i=n.scale,a=n.interaction,c=t.crop.rotation,u=t.crop.flip,l=!(!t.crop.draft.rectangle&&!t.crop.draft.transforms),s=l||t.instantUpdate;return{canRecenter:Yt(e.limited,t.stage),canReset:t.crop.isDirty||l,isDraft:s,isRotating:t.crop.isRotating,rectangle:e,origin:r,translation:o,scale:i,rotation:c,flip:u,interaction:a}},zt=function(t,e){if(1165519206!==t.getUint32(e+=2,!1))return-1;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var r=t.getUint16(e,n);e+=2;for(var o=0;o<r;o++)if(274===t.getUint16(e+12*o,n))return t.getUint16(e+12*o+8,n)},Xt=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(function(t){var e=new DataView(t);if(65496!=e.getUint16(0,!1))return null;for(var n,r=e.byteLength,o=2;o<r;){if(e.getUint16(o+2,!1)<=8)return-1;if(n=e.getUint16(o,!1),o+=2,65505===n)return zt(e,o);if(65280!=(65280&n))return null;o+=e.getUint16(o,!1)}}(r.result)||-1)},r.readAsArrayBuffer(t.slice(0,262144))})},qt=1,Zt=2,Ft=function(t,e){var n=t.width,r=n*e;r>t.height&&(n=(r=t.height)/e);var o=.5*(t.width-n),i=.5*(t.height-r);return Lt(o,i,n,r)},Ht=function(t,e){var n=t,r=e,o=1.5707963267948966-e,i=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(o),u=Math.cos(o),l=n/i;return Rt(u*(l*a),u*(l*c))},Wt=function(t,e,n,r){var o=r.x>.5?1-r.x:r.x,i=r.y>.5?1-r.y:r.y,a=2*o*t.width,c=2*i*t.height,u=function(t,e){var n=t.width,r=t.height,o=Ht(n,e),i=Ht(r,e),a=Dt(t),c=Rt(a.tl.x+Math.abs(o.x),a.tl.y-Math.abs(o.y)),u=Rt(a.tr.x+Math.abs(i.y),a.tr.y+Math.abs(i.x)),l=Rt(a.bl.x-Math.abs(i.y),a.bl.y-Math.abs(i.x));return{width:bt(c,u),height:bt(c,l)}}(e,n);return Math.max(u.width/a,u.height/c)},Qt=function(t,e,n){var r=t.center,o=t.zoom,i=t.aspectRatio,a=St(e),c={x:a.x-n.width*r.x,y:a.y-n.height*r.y},u=2*Math.PI+t.rotation%(2*Math.PI),l=Wt(n,Ft(e,i||n.height/n.width),u,r);return{origin:{x:r.x*n.width,y:r.y*n.height},translation:c,scale:o*l,rotation:t.rotation}};function Kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Jt(t,e,n[e])})}return t}function Jt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $t=function(t){return{origin:Kt({},t.origin),translation:Kt({},t.translation),rotation:t.rotation,scale:t.scale}},te=function(t,e){var n=e.origin,r=e.translation;return function(t,e,n){return e.reduce(function(t,e){return(0,It[e[0]])(t,e[1],n)},t)}(t,[["scale",e.scale],["translate",r]],n)},ee=function(t,e){var n=t.width,r=t.height,o=e%(Math.PI/2),i=Ht(n,o),a=Ht(r,o),c=Dt(t);return{tl:Rt(c.tl.x+Math.abs(i.x),c.tl.y-Math.abs(i.y)),tr:Rt(c.tr.x+Math.abs(a.y),c.tr.y+Math.abs(a.x)),br:Rt(c.br.x-Math.abs(i.x),c.br.y+Math.abs(i.y)),bl:Rt(c.bl.x-Math.abs(a.y),c.bl.y-Math.abs(a.x))}};function ne(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){re(t,e,n[e])})}return t}function re(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var oe=function(t,e,n,r){var o=n.translation,i=n.scale,a=n.rotation,c=n.origin,u={origin:ne({},c),translation:ne({},o),scale:i,rotation:2*Math.PI+a%(2*Math.PI)},l=t.height/t.width,s={x:c.x+o.x,y:c.y+o.y},f=ee(e,u.rotation),p=xt(f.tl,-u.rotation,s),d=xt(f.tr,-u.rotation,s),h=xt(f.br,-u.rotation,s),y=xt(f.bl,-u.rotation,s),m={x:Math.min(p.x,d.x,h.x,y.x),y:Math.min(p.y,d.y,h.y,y.y),width:Math.max(p.x,d.x,h.x,y.x)-Math.min(p.x,d.x,h.x,y.x),height:Math.max(p.y,d.y,h.y,y.y)-Math.min(p.y,d.y,h.y,y.y)},g=Lt(m.x,m.y,m.width,m.height),v=St(g),E=Mt(g),w=te(t,n),_=St(w),b={x:w.x,y:w.y},O={x:_.x,y:_.y},x=v.x,R=v.y,T={x:b.x,y:b.y,width:w.width,height:w.height};if(!function(t,e){var n=Mt(t),r=Mt(e);return n.left>=r.left&&n.top>=r.top&&n.bottom<=r.bottom&&n.right<=r.right}(g,w))if("moving"===r){T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width);var A=te(t,ne({},n,{scale:u.scale})),I=St(A);O.x=I.x,O.y=I.y,b.x=A.x,b.y=A.y,T.x=O.x-.5*T.width,T.y=O.y-.5*T.height,T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width);var P={x:T.x-b.x,y:T.y-b.y},M={x:P.x*Math.cos(u.rotation)-P.y*Math.sin(u.rotation),y:P.x*Math.sin(u.rotation)+P.y*Math.cos(u.rotation)};u.translation.x+=M.x,u.translation.y+=M.y}else if("resizing"===r){w.width<g.width&&(T.width=g.width,T.height=T.width*l,T.height<g.height&&(T.height=g.height,T.width=T.height/l)),w.height<g.height&&(T.height=g.height,T.width=T.height/l,T.width<g.width&&(T.width=g.width,T.height=T.width*l)),T.x=O.x-.5*T.width,T.y=O.y-.5*T.height,T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width),u.scale=Wt(t,e,u.rotation,{x:(x-T.x)/T.width,y:(R-T.y)/T.height});var C=te(t,ne({},n,{scale:u.scale})),S=St(C);O.x=S.x,O.y=S.y,b.x=C.x,b.y=C.y,T.x=O.x-.5*T.width,T.y=O.y-.5*T.height,T.y>g.y?T.y=g.y:T.y+T.height<E.bottom&&(T.y=E.bottom-T.height),T.x>g.x?T.x=g.x:T.x+T.width<E.right&&(T.x=E.right-T.width);var D={x:T.x-b.x,y:T.y-b.y},L={x:D.x*Math.cos(u.rotation)-D.y*Math.sin(u.rotation),y:D.x*Math.sin(u.rotation)+D.y*Math.cos(u.rotation)};u.translation.x+=L.x,u.translation.y+=L.y}else if("rotating"===r){var G=!1;if(T.y>g.y){var U=T.y-g.y;T.y=g.y,T.height+=2*U,G=!0}if(T.y+T.height<E.bottom){var j=E.bottom-(T.y+T.height);T.y=E.bottom-T.height,T.height+=2*j,G=!0}if(T.x>g.x){var k=T.x-g.x;T.x=g.x,T.width+=2*k,G=!0}if(T.x+T.width<E.right){var V=E.right-(T.x+T.width);T.x=E.right-T.width,T.width+=2*V,G=!0}G&&(u.scale=Wt(t,e,u.rotation,{x:(x-w.x)/w.width,y:(R-w.y)/w.height}))}return ne({},u,{rotation:n.rotation})},ie={n:function(t){return{x:t.x+.5*t.width,y:t.y}},e:function(t){return{x:t.x+t.width,y:t.y+.5*t.height}},s:function(t){return{x:t.x+.5*t.width,y:t.y+t.height}},w:function(t){return{x:t.x,y:t.y+.5*t.height}}},ae=function(t,e){return ie[t](e)};function ce(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ue=function(t,e,n){var r=n.origin,o=n.translation,i=(n.scale,2*Math.PI+n.rotation%(2*Math.PI)),a=te(t,n),c={x:r.x+o.x,y:r.y+o.y},u=ee(e,i),l=xt(u.tl,-i,c),s=xt(u.tr,-i,c),f=xt(u.br,-i,c),p={x:Math.min(l.x,s.x,f.x),y:Math.min(l.y,s.y,f.y),width:Math.max(l.x,s.x,f.x)-Math.min(l.x,s.x,f.x),height:Math.max(l.y,s.y,f.y)-Math.min(l.y,s.y,f.y)},d=Lt(p.x,p.y,p.width,p.height),h=Mt(d),y=Mt(a),m=a;if(h.top<y.top||h.right>y.right||h.bottom>y.bottom||h.left<y.left){var g=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ce(t,e,n[e])})}return t}({},y);if(h.top<=g.top){var v=g.bottom-g.top,E=g.right-g.left,w=Math.max(1,d.height/v),_=v*w,b=E*w-E;g.bottom=h.top+_,g.top=h.top,g.left-=.5*b,g.right+=.5*b}if(h.bottom>=g.bottom){var O=g.bottom-g.top,x=g.right-g.left,R=Math.max(1,d.height/O),T=O*R,A=x*R-x;g.bottom=h.bottom,g.top=h.bottom-T,g.left-=.5*A,g.right+=.5*A}if(h.left<=g.left){var I=g.bottom-g.top,P=g.right-g.left,M=Math.max(1,d.width/P),C=P*M,S=I*M-I;g.right=h.left+C,g.left=h.left,g.top-=.5*S,g.bottom+=.5*S}if(h.right>=g.right){var D=g.bottom-g.top,L=g.right-g.left,G=Math.max(1,d.width/L),U=L*G,j=D*G-D;g.right=h.right,g.left=h.right-U,g.top-=.5*j,g.bottom+=.5*j}m=Lt(g.left,g.top,g.right-g.left,g.bottom-g.top)}var k=Dt(m),V=St(m),N=xt(k.tl,i,c),Y=xt(k.br,i,c),B=N.x+.5*(Y.x-N.x),z=N.y+.5*(Y.y-N.y),X=At(m,{x:B-V.x,y:z-V.y}),q=At(d,{x:B-V.x,y:z-V.y}),Z=St(q),F={x:X.x,y:X.y},H=X.width,W=X.height,Q=(Z.x-F.x)/H,K=(Z.y-F.y)/W,J=H/t.width,$={x:Q*t.width,y:K*t.height},tt=1-J,et=$.x*tt,nt=$.y*tt,rt={x:F.x+H*Q,y:F.y+W*K},ot=xt(F,i,{x:F.x+.5*H,y:F.y+.5*W}),it=xt(F,i,rt),at=ot.x-it.x,ct=ot.y-it.y;return{origin:$,translation:{x:F.x-et+at,y:F.y-nt+ct},scale:J,rotation:n.rotation}},le={nw:function(t){return{x:t.x,y:t.y}},ne:function(t){return{x:t.x+t.width,y:t.y}},se:function(t){return{x:t.x+t.width,y:t.y+t.height}},sw:function(t){return{x:t.x,y:t.y+t.height}}},se=function(t,e){return le[t](e)},fe=function(t,e,n){var r=n.origin,o=n.translation,i=te(t,n),a={x:r.x+o.x,y:r.y+o.y},c=2*Math.PI+n.rotation%(2*Math.PI),u=ee(e,c),l=xt(u.tl,-c,a),s=xt(u.tr,-c,a),f=xt(u.br,-c,a),p={x:Math.min(l.x,s.x,f.x),y:Math.min(l.y,s.y,f.y),width:Math.max(l.x,s.x,f.x)-Math.min(l.x,s.x,f.x),height:Math.max(l.y,s.y,f.y)-Math.min(l.y,s.y,f.y)},d=Lt(p.x,p.y,p.width,p.height),h=St(d),y=e.height/e.width,m={x:(h.x-i.x)/i.width,y:(h.y-i.y)/i.height},g=m.y>.5?1-m.y:m.y,v=2*(m.x>.5?1-m.x:m.x)*i.width,E=2*g*i.height;return{center:m,zoom:Math.min(v/d.width,E/d.height),rotation:n.rotation,aspectRatio:y}},pe=Math.PI/2,de=Math.PI/4,he=function(t){var e=Et(de),n=Et(pe),r=t/n,o=Math.floor(r)*n,i=t-o;return i>e&&(i-=n,o+=n),{main:o,sub:i}},ye=function(t,e){var n={width:t.width,height:t.height};if(t.width>e.width||t.height>e.height){var r=t.height/t.width,o=e.width/t.width,i=e.height/t.height;o<i?(n.width=t.width*o,n.height=n.width*r):(n.height=t.height*i,n.width=n.height/r)}return n},me={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},ge=function(t,e){return{x:t,y:e}},ve=function(t,e){return ge(t.x-e.x,t.y-e.y)},Ee=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(ve(t,e),ve(t,e))}(t,e))},we=function(t,e){var n=t,r=e,o=1.5707963267948966-e,i=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(o),u=Math.cos(o),l=n/i;return ge(u*(l*a),u*(l*c))},_e=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},o=r.x>.5?1-r.x:r.x,i=r.y>.5?1-r.y:r.y,a=2*o*t.width,c=2*i*t.height,u=function(t,e){var n=t.width,r=t.height,o=we(n,e),i=we(r,e),a=ge(t.x+Math.abs(o.x),t.y-Math.abs(o.y)),c=ge(t.x+t.width+Math.abs(i.y),t.y+Math.abs(i.x)),u=ge(t.x-Math.abs(i.y),t.y+t.height-Math.abs(i.x));return{width:Ee(a,c),height:Ee(a,u)}}(e,n);return Math.max(u.width/a,u.height/c)},be=function(t,e){var n=t.width,r=n*e;return r>t.height&&(n=(r=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-r),width:n,height:r}},Oe=function(t){return t&&(t.horizontal||t.vertical)},xe=function(t,e,n){if(!e&&!Oe(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),o=t.naturalWidth,i=t.naturalHeight,a=e>=5&&e<=8;a?(r.width=i,r.height=o):(r.width=o,r.height=i);var c=r.getContext("2d");if(e&&c.transform.apply(c,function(t,e,n){return-1===n&&(n=1),me[n](t,e)}(o,i,e)),Oe(n)){var u=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(u[0]=-1,u[4]=o),(!a&&n.vertical||a&&n.horizontal)&&(u[3]=-1,u[5]=i),c.transform.apply(c,u)}return c.drawImage(t,0,0,o,i),r},Re=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.zoom||1,o=xe(t,e,n.flip),i={width:o.width,height:o.height},a=document.createElement("canvas"),c=n.aspectRatio||i.height/i.width,u=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.height/t.width,o=e,i=1,a=r;a>o&&(i=(a=o)/r);var c=Math.max(1/i,o/a),u=t.width/(n*c*i),l=u*e;return{width:Math.round(u),height:Math.round(l)}}(i,c,r),l={x:.5*u.width,y:.5*u.height},s={x:0,y:0,width:u.width,height:u.height,center:l},f=r*_e(i,be(s,c),n.rotation,n.center);a.width=Math.ceil(u.width/f),a.height=Math.ceil(u.height/f),l.x/=f,l.y/=f;var p=l.x-i.width*(n.center?n.center.x:.5),d=l.y-i.height*(n.center?n.center.y:.5),h=a.getContext("2d");return h.translate(l.x,l.y),h.rotate(n.rotation||0),h.drawImage(o,p-l.x,d-l.y,i.width,i.height),h.getImageData(0,0,a.width,a.height)};ht()&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var r=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(r),o=n.length,i=new Uint8Array(o),a=0;a<o;a++)i[a]=n.charCodeAt(a);t(new Blob([i],{type:e||"image/png"}))})}}));var Te=function(){var t={resize:function(t,e){var n=e.mode,r=e.upscale,o=e.width,i=e.height;if(!o&&!i)return t;null===o?o=i:null===i&&(i=o);if("force"!==n){var a=o/t.width,c=i/t.height,u=1;if("cover"===n?u=Math.max(a,c):"contain"===n&&(u=Math.min(a,c)),u>1&&!1===r)return t;o=t.width*u,i=t.height*u}for(var l=t.width,s=t.height,f=Math.round(o),p=Math.round(i),d=t.data,h=new Uint8ClampedArray(f*p*4),y=l/f,m=s/p,g=Math.ceil(.5*y),v=Math.ceil(.5*m),E=0;E<p;E++)for(var w=0;w<f;w++){for(var _=4*(w+E*f),b=0,O=0,x=0,R=0,T=0,A=0,I=0,P=(E+.5)*m,M=Math.floor(E*m);M<(E+1)*m;M++)for(var C=Math.abs(P-(M+.5))/v,S=(w+.5)*y,D=C*C,L=Math.floor(w*y);L<(w+1)*y;L++){var G=Math.abs(S-(L+.5))/g,U=Math.sqrt(D+G*G);if(U>=-1&&U<=1&&(b=2*U*U*U-3*U*U+1)>0){var j=d[(G=4*(L+M*l))+3];I+=b*j,x+=b,j<255&&(b=b*j/250),R+=b*d[G],T+=b*d[G+1],A+=b*d[G+2],O+=b}}h[_]=R/O,h[_+1]=T/O,h[_+2]=A/O,h[_+3]=I/x}return{data:h,width:f,height:p}}},e=function(e,n){n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(e.transforms,e.imageData))};self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})}},Ae=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(e+t).slice(-e.length)},Ie=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return"".concat(t.getFullYear(),"-").concat(Ae(t.getMonth()+1,"00"),"-").concat(Ae(t.getDate(),"00"),"_").concat(Ae(t.getHours(),"00"),"-").concat(Ae(t.getMinutes(),"00"),"-").concat(Ae(t.getSeconds(),"00"))},Pe=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var o=ot();r.onmessage=function(t){t.data.id===o&&e(t.data.message)},r.postMessage({id:o,message:t},n)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},Me=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var r=new n;return r.append(t),r.getBlob(e)}return new Blob([t],{type:e})},Ce=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=function(t){n(t)},r.src=t})},Se=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var r=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,r);var o=t.getUint16(e,r);e+=2;for(var i=0;i<o;i++)if(274===t.getUint16(e+12*i,r))return t.setUint16(e+12*i+8,1,r),!0;return!1}},De=function(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,r,o=2,i=!1;o<e.byteLength&&(n=e.getUint16(o,!1),r=e.getUint16(o+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(i||(i=Se(e,o)),!(o+r>e.byteLength));)o+=r;return t.slice(0,o)}(r.result)||null)},r.readAsArrayBuffer(t.slice(0,262144))})},Le=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,o){var i=n.stripImageHead,a=n.beforeCreateBlob;if(!function(t){return/^image/.test(t.type)}(t))return o();var c=e.output.quality,u=null===c?null:c/100,l=e.output.type,s=e.crop,f=e.size,p=[];(f.width||f.height)&&p.push({type:"resize",data:f});var d=function(e){var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o="string"==typeof n?t.slice(0,t.size,n):t.slice(0,t.size,t.type);return o.lastModifiedDate=new Date,Z(e)||(e=Ie()),e&&null===r&&function(t){return t.split(".").pop()}(e)?o.name=e:(r=r||function(t){if("string"!=typeof t)return"";var e=t.split("/").pop();return/svg/.test(e)?"svg":/zip|compressed/.test(e)?"zip":/plain/.test(e)?"txt":/msword/.test(e)?"doc":/[a-z]+/.test(e)?"jpeg"===e?"jpg":e:""}(o.type),o.name=e+(r?"."+r:"")),o}(e,function(t,e){var n=function(t){return t.substr(0,t.lastIndexOf("."))||t}(t),r="image/jpeg"===e?"jpg":e.split("/")[1];return"".concat(n,".").concat(r)}(t.name,function(t){return"image/jpeg"===t||"image/png"===t?t:"image/jpeg"}(e.type)));r(n)},h=function(e,n){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(r){var o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(t,0,0);var i=n?n(o):o;Promise.resolve(i).then(function(t){t.toBlob(r,e.type,e.quality)})})}(e,n,a).then(function(e){if(i)return d(e);De(t).then(function(t){null!==t&&(e=new Blob([t,e.slice(20)],{type:e.type})),d(e)})}).catch(function(t){o(t)})};if(/svg/.test(t.type)&&null===l)(function(t,e){return new Promise(function(n,r){var o=new FileReader;o.onloadend=function(){var r=o.result,i=document.createElement("div");i.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",i.innerHTML=r;var a=i.querySelector("svg");document.body.appendChild(i);var c=a.getBBox();i.parentNode.removeChild(i);var u=i.querySelector("title"),l=a.getAttribute("viewBox")||"",s=a.getAttribute("width")||"",f=a.getAttribute("height")||"",p=parseFloat(s)||null,d=parseFloat(f)||null,h=(s.match(/[a-z]+/)||[])[0]||"",y=(f.match(/[a-z]+/)||[])[0]||"",m=l.split(" ").map(parseFloat),g=m.length?{x:m[0],y:m[1],width:m[2],height:m[3]}:c,v=null!=p?p:g.width,E=null!=d?d:g.height;a.style.overflow="visible",a.setAttribute("width",v),a.setAttribute("height",E);var w=e.aspectRatio||E/v,_=v,b=_*w,O=_e({width:v,height:E},be({width:_,height:b},w),e.rotation,e.center),x=e.zoom*O,R=e.rotation*(180/Math.PI),T={x:.5*_,y:.5*b},A={x:T.x-v*e.center.x,y:T.y-E*e.center.y},I=["rotate(".concat(R," ").concat(T.x," ").concat(T.y,")"),"translate(".concat(T.x," ").concat(T.y,")"),"scale(".concat(x,")"),"translate(".concat(-T.x," ").concat(-T.y,")"),"translate(".concat(A.x," ").concat(A.y,")")],P=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-v:0," ").concat(e.flip.vertical?-E:0,")")],M='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(_).concat(h,'" height="').concat(b).concat(y,'" \nviewBox="0 0 ').concat(_," ").concat(b,'" \npreserveAspectRatio="xMinYMin"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generator: FilePond Image Transform Plugin - https://pqina.nl/filepond --\x3e\n<title>').concat(u?u.textContent:t.name,'</title>\n<desc>Cropped with FilePond.</desc>\n<g transform="').concat(I.join(" "),'">\n<g transform="').concat(P.join(" "),'">\n').concat(a.outerHTML,"\n</g>\n</g>\n</svg>");n(M)},o.readAsText(t)})})(t,s).then(function(e){r(function(t,e){var n=t.slice(0,t.size,t.type);return n.lastModifiedDate=t.lastModifiedDate,n.name=e,n}(Me(e,"image/svg+xml"),t.name))});else{var y=URL.createObjectURL(t);Ce(y).then(function(n){URL.revokeObjectURL(y);var r=e.image.orientation,o=Re(n,r,s);if(p.length){var i=Pe(Te);i.post({transforms:p,imageData:o},function(e){h(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(e),{quality:u,type:l||t.type}),i.terminate()},[o.data.buffer])}else h(o,{quality:u,type:l||t.type})})}})};function Ge(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ue(t,e,n[e])})}return t}function Ue(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var je=Math.PI/2,ke=function(t){t.crop.draft.rotateMinScale=null},Ve=function(t,e,n){!function(t){t.crop.draft.rotateMinScale||(t.crop.draft.rotateMinScale=t.crop.transforms.scale)}(t);var r=Ge({},t.crop.transforms,{scale:t.crop.draft.rotateMinScale});t.crop.draft.transforms=We(t.image,t.crop.rectangle,r,e.main+e.sub,n,t.crop.draft.transforms?t.crop.draft.transforms.rotation:t.crop.rotation.main+t.crop.rotation.sub),t.crop.rotation=he(t.crop.draft.transforms.rotation)},Ne=function(t){null!==t.stage&&(qe(t),t.crop.rectangle=Ft(t.stage,t.crop.instructions.aspectRatio||t.image.aspectRatio),t.crop.draft.rectangle=null,t.crop.transforms=Qt(t.crop.instructions,t.stage,t.image),t.crop.draft.transforms=null,t.crop.rotation=he(t.crop.instructions.rotation),t.crop.flip=Ge({},t.crop.instructions.flip),t.crop.aspectRatio=t.crop.instructions.aspectRatio,t.crop.isDirty=!1,ke(t))},Ye=function(t){qe(t);var e=t.crop.draft.transforms||t.crop.transforms,n=fe(t.image,t.crop.rectangle,e);t.crop.aspectRatio&&(n.aspectRatio=t.crop.aspectRatio),t.crop.transforms=Qt(n,t.stage,t.image),t.crop.draft.transforms=null;var r=t.crop.aspectRatio||t.crop.rectangle.height/t.crop.rectangle.width;t.crop.rectangle=Ft(t.stage,r),t.crop.draft.rectangle=null,ke(t)},Be=function(t){t.crop.draft.rectangle=null,t.crop.transforms=t.crop.draft.transforms||t.crop.transforms,t.crop.transforms.interaction=null,t.crop.draft.transforms=null,t.crop.transforms=Ge({},t.crop.transforms,function(t,e,n){var r=n.origin,o=n.translation,i=n.scale,a=2*Math.PI+n.rotation%(2*Math.PI),c={x:r.x+o.x,y:r.y+o.y},u=ee(e,a),l=xt(u.tl,-a,c),s=xt(u.tr,-a,c),f=xt(u.br,-a,c),p=xt(u.bl,-a,c),d=Lt(Math.min(l.x,s.x,f.x,p.x),Math.min(l.y,s.y,f.y,p.y),Math.max(l.x,s.x,f.x,p.x)-Math.min(l.x,s.x,f.x,p.x),Math.max(l.y,s.y,f.y,p.y)-Math.min(l.y,s.y,f.y,p.y)),h=Lt(d.x,d.y,d.width,d.height),y=te(t,n),m=Dt(y),g=St(y),v=xt(m.tl,a,c),E=xt(m.br,a,c),w=v.x+.5*(E.x-v.x),_=v.y+.5*(E.y-v.y),b=At(y,{x:w-g.x,y:_-g.y}),O=At(h,{x:w-g.x,y:_-g.y}),x=St(O),R={x:b.x,y:b.y},T=b.width,A=b.height,I=(x.x-R.x)/T,P=(x.y-R.y)/A,M={x:I*t.width,y:P*t.height},C=1-i,S=M.x*C,D=M.y*C,L={x:R.x+T*I,y:R.y+A*P},G=xt(R,a,{x:R.x+.5*T,y:R.y+.5*A}),U=xt(R,a,L),j=G.x-U.x,k=G.y-U.y;return{origin:wt(M),translation:wt({x:R.x-S+j,y:R.y-D+k})}}(t.image,t.crop.rectangle,t.crop.transforms)),t.crop.isRotating=!1,t.crop.isDirty=!0},ze=function(t,e,n){var r=e("GET_CROP_ZOOM_TIMEOUT");r&&(clearTimeout(t.zoomTimeoutId),t.zoomTimeoutId=setTimeout(function(){n("CROP_ZOOM")},r))},Xe=function(t,e,n){qe(t),ze(t,e,n)},qe=function(t){clearTimeout(t.zoomTimeoutId)},Ze=function(t){t.crop.rectangle=t.crop.draft.rectangle.limited,t.crop.draft.rectangle=null,Be(t),ke(t)},Fe=function(t){t.crop.draft.transforms=$t(t.crop.transforms),t.crop.draft.rectangle={limited:Pt(t.crop.rectangle),free:Pt(t.crop.rectangle)},qe(t)},He=function(t,e){return Math.min(t.width/e.width,t.height/e.height)},We=function(t,e,n,r,o,i){var a=oe(t,e,Ge({},$t(n),{rotation:r}),"rotating"),c=He(e,o);return Et(a.scale,5)>Et(c,5)?Ge({},$t(n),{rotation:i,interaction:{rotation:a.rotation}}):(a.scale=Math.min(c,a.scale),a.interaction={rotation:a.rotation},a)},Qe=function(t,e,n,r,o){var i=Math.max(1e-10,r),a=oe(t,e,Ge({},$t(n),{scale:i}),"resizing"),c=He(e,o);return a.scale=Math.min(c,a.scale),a.interaction={scale:i},a},Ke=function(t){var e=fe(t.image,t.crop.rectangle,t.crop.transforms);return{center:{x:Et(e.center.x),y:Et(e.center.y)},rotation:Et(e.rotation),zoom:Et(e.zoom),aspectRatio:Et(e.aspectRatio),flip:Ge({},t.crop.flip)}},Je=function(t){return!1===t.file},$e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:t("GET_CROP_ASPECT_RATIO")};Object.assign(n,e);var r=t("GET_CROP_ASPECT_RATIO_OPTIONS");r&&(r.find(function(t){return t.value===n.aspectRatio})||(n.aspectRatio=r[0].value));return n},tn=function(t,e,n){return{AWAIT_IMAGE:function(){n.file||(n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},250))},REQUEST_REMOVE_IMAGE:function(){t("UNLOAD_IMAGE"),n.file=!1,n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},500)},DID_UNLOAD_IMAGE:function(){t("ABORT_IMAGE")},REQUEST_ABORT_IMAGE:function(e){t("UNLOAD_IMAGE"),n.file=!1,n.queuedFile=e},DID_SET_SRC:function(e){e.value!==e.prevValue&&(clearTimeout(n.noImageTimeout),t("REQUEST_LOAD_IMAGE",{source:e.value}))},ABORT_IMAGE:function(){if(n.file=null,n.queuedFile){var e=n.queuedFile;n.queuedFile=null,t("REQUEST_LOAD_IMAGE",e)}},REQUEST_LOAD_IMAGE:function(e){var r=e.source,o=e.success,i=void 0===o?function(){}:o,a=e.failure,c=void 0===a?function(t){}:a,u=e.options,l=e.resolveOnConfirm,s=void 0!==l&&l;if(clearTimeout(n.noImageTimeout),!r)return c();null===n.file?(nt(n),n.file={uid:ot()},t("DID_REQUEST_LOAD_IMAGE"),function(t){return new Promise(function(e,n){if(Z(t))fetch(t).then(function(t){return t.blob()}).then(function(t){return e(t)});else if(t instanceof Blob)e(t);else{if("IMG"===t.nodeName){var r=function(t){var n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight,n.getContext("2d").drawImage(t,0,0),n.toBlob(e)};return t.complete?void r(t):void(t.onload=function(){r(t)})}"CANVAS"!==t.nodeName?n(t):t.toBlob(e)}})}(r).then(function(e){if(Je(n))return t("ABORT_IMAGE");e.name||(e.name=Ie()),n.file.orientation=-1,n.file.data=e,t("LOAD_IMAGE",{success:i,failure:c,options:u,resolveOnConfirm:s},!0),t("KICK")}).catch(function(e){if(Je(n))return t("ABORT_IMAGE");c(e)})):t("REQUEST_ABORT_IMAGE",{source:r,success:i,failure:c,options:u,resolveOnConfirm:s})},LOAD_IMAGE:function(r){var o=r.success,i=r.failure,a=r.options,c=void 0===a?{}:a,u=r.resolveOnConfirm;if(Je(n))return t("ABORT_IMAGE");var l=n.file.data;Promise.all([function(t){return new Promise(function(e,n){var r=new Image;r.src=URL.createObjectURL(t),r.onerror=function(t){clearInterval(o),n(t)};var o=setInterval(function(){r.naturalWidth&&r.naturalHeight&&(clearInterval(o),URL.revokeObjectURL(r.src),e({width:r.naturalWidth,height:r.naturalHeight}))},1)})}(l),Xt(l)]).then(function(r){if(Je(n))return t("ABORT_IMAGE");var a=r[0],l=r[1];n.file.orientation=l;var s=a.width,f=a.height;l>=5&&l<=8?(a.width=f,a.height=s):(a.width=s,a.height=f);var p=e("GET_MIN_IMAGE_SIZE");if(a.width<p.width||a.height<p.height)return t("DID_LOAD_IMAGE_ERROR"),nt(n),void i();var d=ye(a,{width:e("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e("GET_MAX_IMAGE_PREVIEW_HEIGHT")});n.image={x:0,y:0,width:d.width,height:d.height,naturalWidth:a.width,naturalHeight:a.height,aspectRatio:a.height/a.width},n.crop.instructions=$e(e,c.crop?Ge({},c.crop):n.options.crop?Ge({},n.options.crop):{}),n.crop.aspectRatio=n.crop.instructions.aspectRatio,t("DID_LOAD_IMAGE"),n.filePromise={resolveOnConfirm:u,success:o,failure:i}}).catch(function(e){if(Je(n))return t("ABORT_IMAGE");t("DID_LOAD_IMAGE_ERROR"),nt(n),i()})},DID_UPDATE_VIEWPORT:function(t){var e=t.rect;n.root=e},DID_RESIZE_STAGE:function(t){var r=t.size,o=r.width,i=r.height,a=null===n.stage;n.stage=Lt(0,0,o,i),a?(Ne(n),n.filePromise.resolveOnConfirm||n.filePromise.success({crop:Ke(n),image:{orientation:n.file.orientation},size:{mode:e("GET_OUTPUT_FIT"),upscale:e("GET_OUTPUT_UPSCALE"),width:e("GET_OUTPUT_WIDTH"),height:e("GET_OUTPUT_HEIGHT")},output:{type:e("GET_OUTPUT_TYPE"),quality:e("GET_OUTPUT_QUALITY")}})):(n.instantUpdate=!0,Ye(n),setTimeout(function(){n.instantUpdate=!1},16))},CROP_ZOOM:function(){qe(n),Ye(n)},CROP_SET_ASPECT_RATIO:function(t){var e=t.value;qe(n),n.crop.aspectRatio=e,Ye(n),n.crop.isDirty=!0},CROP_RECT_CORNER_DRAG_RELEASE:function(){return Ze(n)||ze(n,e,t)},CROP_RECT_EDGE_DRAG_RELEASE:function(){return Ze(n)||ze(n,e,t)},CROP_IMAGE_RESIZE_GRAB:function(){return Fe(n)||qe(n)},CROP_IMAGE_ROTATE_GRAB:function(){Fe(n),qe(n),n.crop.isRotating=!0},CROP_RECT_EDGE_DRAG_GRAB:function(){return Fe(n)||qe(n)},CROP_RECT_CORNER_DRAG_GRAB:function(){return Fe(n)||qe(n)},CROP_RECT_EDGE_DRAG:function(t){var r=t.offset,o=t.origin,i=t.anchor,a=n.image,c=n.stage,u=/n|s/.test(o)?Zt:qt,l=ae(o,n.crop.rectangle),s=ae(i,n.crop.rectangle),f=Ot({x:l.x+(u===qt?r.x:0),y:l.y+(u===Zt?r.y:0)},c),p=e("GET_MIN_CROP_SIZE"),d=e("GET_MAX_CROP_SIZE"),h=He(n.crop.rectangle,e("GET_MIN_IMAGE_SIZE"))/n.crop.transforms.scale;p.width=Et(p.width),p.height=Et(p.height),d.width=Et(d.width*h),d.height=Et(d.height*h);var y={x:Math.sign(l.x-s.x),y:Math.sign(l.y-s.y)};n.crop.draft.rectangle=function(t,e,n,r,o,i,a,c,u){var l=i.left,s=i.right,f=i.top,p=i.bottom,d=s-l,h=p-f,y=o.left,m=o.right,g=o.top,v=o.bottom;if(n===Zt){if(g=t.y>0?r.y:Math.min(r.y,Math.max(e.y,f)),v=t.y>0?Math.max(r.y,Math.min(e.y,p)):r.y,a){var E=(v-g)/a;y=r.x-.5*E,m=r.x+.5*E}}else if(y=t.x>0?r.x:Math.min(r.x,Math.max(e.x,l)),m=t.x>0?Math.max(r.x,Math.min(e.x,s)):r.x,a){var w=(m-y)*a;g=r.y-.5*w,v=r.y+.5*w}var _,b,O,x,R=c.width,T=c.height;if(n===Zt?(_=r.x-.5*R,b=r.x+.5*R,t.y<0?(O=r.y-T,x=r.y):t.y>0&&(O=r.y,x=r.y+T)):(O=r.y-.5*T,x=r.y+.5*T,t.x<0?(_=r.x-R,b=r.x):t.x>0&&(_=r.x,b=r.x+R)),a)if(n===Zt){var A=Math.min((v-g)/a,d),I=A*a;y<l&&(m=(y=l)+A),m>s&&(y=(m=s)-A),r.x=y+.5*A,t.y<0?g=r.y-I:t.y>0&&(v=r.y+I)}else{var P=Math.min((m-y)*a,h),M=P/a;g<f&&(v=(g=f)+P),v>p&&(g=(v=p)-P),r.y=g+.5*P,t.x<0?y=r.x-M:t.x>0&&(m=r.x+M)}var C=Ct({top:g,right:m,bottom:v,left:y}),S=function(){var e=R*a;n===qt?(g=r.y-.5*e,v=r.y+.5*e):t.y<0?(v=r.y,g=v-e):t.y>0&&(g=r.y,v=g+e)},D=function(){var e=T/a;n===Zt?(y=r.x-.5*e,m=r.x+.5*e):t.x<0?(m=r.x,y=m-e):t.x>0&&(y=r.x,m=y+e)};if(m<b&&(m=b,y=b-R,a&&S()),y>_&&(y=_,m=_+R,a&&S()),g>O&&(g=O,v=O+T,a&&D()),v<x&&(v=x,g=x-T,a&&D()),m-y>u.width&&(t.x<0?y=r.x-u.width:m=r.x+u.width),v-g>u.height&&(t.y<0?g=r.y-u.height:v=r.y+u.height),m-y==0&&(t.x>0?m=r.x+2:y=r.x-2),v-g==0&&(t.y>0?v=r.y+2:g=r.y-2),Math.round(y)<l||Math.round(m)>s||Math.round(g)<f||Math.round(v)>p){var L=p-f,G=s-l;if(y<l){y=l;var U=Math.min(m-y,G);m=y+U}if(m>s){m=s;var j=Math.min(m-y,G);y=m-j}if(g<f){g=f;var k=Math.min(v-g,L);v=g+k}if(v>p){v=p;var V=Math.min(v-g,L);g=v-V}C=Ct({top:g,right:m,bottom:v,left:y})}return{free:C,limited:Ct({top:g,right:m,bottom:v,left:y})}}(y,f,u,s,Mt(n.crop.rectangle),Mt(c),n.crop.aspectRatio,p,d),n.crop.draft.transforms=ue(a,n.crop.draft.rectangle.limited,n.crop.transforms)},CROP_RECT_CORNER_DRAG:function(t){var r=t.offset,o=t.origin,i=t.anchor,a=n.image,c=n.stage,u=se(o,n.crop.rectangle),l=se(i,n.crop.rectangle),s={x:u.x+r.x,y:u.y+r.y},f=e("GET_MIN_CROP_SIZE"),p=e("GET_MAX_CROP_SIZE"),d=He(n.crop.rectangle,e("GET_MIN_IMAGE_SIZE"))/n.crop.transforms.scale;f.width=Et(f.width),f.height=Et(f.height),p.width=Et(p.width*d),p.height=Et(p.height*d);var h={x:Math.sign(u.x-l.x),y:Math.sign(u.y-l.y)};n.crop.draft.rectangle=function(t,e,n,r,o,i,a){var c=Mt(r),u=c.left,l=c.right,s=c.top,f=c.bottom,p=Ot({x:e.x,y:e.y},r),d=t.x>0?n.x:Math.min(p.x,n.x),h=t.x>0?Math.max(n.x,p.x):n.x,y=t.y>0?n.y:Math.min(p.y,n.y),m=t.y>0?Math.max(n.y,p.y):n.y;if(o){var g=p.x-n.x;t.x>0?h=Math.max(n.x,n.x+t.x*g):d=Math.min(n.x,n.x-t.x*g),t.y>0?m=Math.max(n.y,n.y+t.x*g*o):y=Math.min(n.y,n.y-t.x*g*o)}var v=Ct({top:y,right:h,bottom:m,left:d});Ct({top:y,right:h,bottom:m,left:d});if(i.width&&i.height&&(h-d<i.width&&(t.x>0?h=n.x+i.width:d=n.x-i.width),m-y<i.height&&(t.y>0?m=n.y+i.height:y=n.y-i.height),h-d>a.width&&(t.x<0?d=n.x-a.width:h=n.x+a.width),m-y>a.height&&(t.y<0?y=n.y-a.height:m=n.y+a.height)),h-d==0&&(t.x>0?h=n.x+2:d=n.x-2),m-y==0&&(t.y>0?m=n.y+2:y=n.y-2),Math.round(d)<u||Math.round(h)>l||Math.round(y)<s||Math.round(m)>f){var E=f-s,w=l-u;if(d<u){d=u;var _=Math.min(h-d,w);h=d+_,o&&(t.y>0&&(m=n.y+_*o),t.y<0&&(y=n.y-_*o))}if(h>l){h=l;var b=Math.min(h-d,w);d=h-b,o&&(t.y>0&&(m=n.y+b*o),t.y<0&&(y=n.y-b*o))}if(y<s){y=s;var O=Math.min(m-y,E);m=y+O,o&&(t.x>0&&(h=n.x+O/o),t.x<0&&(d=n.x-O/o))}if(m>f){m=f;var x=Math.min(m-y,E);y=m-x,o&&(t.x>0&&(h=n.x+x/o),t.x<0&&(d=n.x-x/o))}v=Ct({top:y,right:h,bottom:m,left:d})}return{free:v,limited:Ct({top:y,right:h,bottom:m,left:d})}}(h,s,l,c,n.crop.aspectRatio,f,p),n.crop.draft.transforms=ue(a,n.crop.draft.rectangle.limited,n.crop.transforms)},CROP_IMAGE_DRAG_GRAB:function(){return Fe(n)||qe(n)},CROP_IMAGE_DRAG_RELEASE:function(){Be(n),ke(n),ze(n,e,t)},CROP_IMAGE_RESIZE_RELEASE:function(){Be(n),ke(n),ze(n,e,t)},CROP_IMAGE_ROTATE_RELEASE:function(){Be(n),ze(n,e,t)},CROP_IMAGE_DRAG:function(t){var e=t.value;qe(n),n.crop.draft.transforms=function(t,e,n,r){var o={x:n.translation.x+r.x,y:n.translation.y+r.y},i=oe(t,e,Ge({},$t(n),{translation:o}),"moving");return i.interaction={translation:o},i}(n.image,n.crop.rectangle,n.crop.transforms,e)},CROP_IMAGE_RESIZE:function(t){var r=t.value;qe(n);var o=n.crop.transforms;n.crop.draft.transforms=Qe(n.image,n.crop.rectangle,o,o.scale+o.scale*r,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_RESIZE_MULTIPLY:function(t){var r=t.value;qe(n);var o=n.crop.transforms;n.crop.draft.transforms=Qe(n.image,n.crop.rectangle,o,o.scale*r,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_RESIZE_AMOUNT:function(t){var r=t.value;qe(n);var o=n.crop.transforms;n.crop.draft.transforms=Qe(n.image,n.crop.rectangle,o,(n.crop.draft.transforms?n.crop.draft.transforms.scale:o.scale)+r,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_ROTATE:function(t){var r=t.value;qe(n),n.crop.isRotating=!0,Ve(n,{main:n.crop.rotation.main,sub:r},e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_ROTATE_ADJUST:function(t){var r=t.value;qe(n),Ve(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+r))},e("GET_MIN_PREVIEW_IMAGE_SIZE")),Be(n)},CROP_IMAGE_ROTATE_CENTER:function(){qe(n),Ve(n,{main:n.crop.rotation.main,sub:0},e("GET_MIN_PREVIEW_IMAGE_SIZE")),Be(n)},CROP_IMAGE_ROTATE_LEFT:function(){Xe(n,e,t),Ve(n,{main:n.crop.rotation.main-je,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE")),Be(n)},CROP_IMAGE_ROTATE_RIGHT:function(){Xe(n,e,t),Ve(n,{main:n.crop.rotation.main+je,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE")),Be(n)},CROP_IMAGE_FLIP_HORIZONTAL:function(){Xe(n,e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){Xe(n,e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},DID_SET_CROP:function(e){var n=e.value;n!==e.prevValue&&t("SET_DATA",{crop:n})},SET_DATA:function(r){n.crop.instructions=$e(e,r.crop),n.crop.aspectRatio=n.crop.instructions.aspectRatio,t("EDIT_RESET")},GET_DATA:function(r){var o=r.success,i=r.failure,a=r.file,c=r.data;if(n.file&&n.stage){var u={file:q(a)?a:e("GET_OUTPUT_FILE"),data:q(c)?c:e("GET_OUTPUT_DATA"),success:o,failure:i};t(u.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",u)}},REQUEST_PREPARE_OUTPUT:function(e){var n=e.file,r=e.data,o=e.success,i=e.failure;t("PREPARE_OUTPUT",{file:n,data:r,success:o,failure:i},!0)},PREPARE_OUTPUT:function(r){var o=r.file,i=r.data,a=r.success,c=r.failure;if(Je(n))return t("ABORT_IMAGE");(function(t,e,n){return new Promise(function(r,o){var i={data:null,file:null},a={crop:Ke(e),image:{orientation:e.file.orientation},size:{mode:n("GET_OUTPUT_FIT"),upscale:n("GET_OUTPUT_UPSCALE"),width:n("GET_OUTPUT_WIDTH"),height:n("GET_OUTPUT_HEIGHT")},output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY")}};if(t.data&&(i.data=a),t.file){var c={beforeCreateBlob:n("GET_BEFORE_CREATE_BLOB"),stripImageHead:n("GET_OUTPUT_STRIP_IMAGE_HEAD")};Le(e.file.data,a,c).then(function(t){i.file=t,r(i)}).catch(o)}else r(i)})})({file:o,data:i},n,e).then(function(e){if(t("DID_PREPARE_OUTPUT"),Je(n))return t("ABORT_IMAGE");a(e)}).catch(function(e){if(Je(n))return t("ABORT_IMAGE");c(e)})},EDIT_RESET:function(){qe(n),Ne(n)},EDIT_CONFIRM:function(){if(n.file&&n.stage){qe(n),t("CROP_ZOOM");var r={file:e("GET_OUTPUT_FILE"),data:e("GET_OUTPUT_DATA"),success:function(e){n.filePromise.resolveOnConfirm&&n.filePromise.success(e),t("DID_CONFIRM",{output:e})}};t(r.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",r)}},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.success(null),t("DID_CANCEL")},EDIT_CLOSE:function(){qe(n)},EDIT_DESTROY:function(){nt(n)},SET_OPTIONS:function(e){var n=e.options;l(n,function(e,n){t("SET_".concat(rt(e,"_").toUpperCase()),{value:n})})}}},en={down:"pointerdown",move:"pointermove",up:"pointerup"},nn=function(){var t=[],e=function(e){return t.findIndex(function(t){return t.pointerId===e.pointerId})};return{update:function(n){var r=e(n);r<0||(t[r]=n)},multiple:function(){return t.length>1},count:function(){return t.length},active:function(){return t.concat()},push:function(n){(function(t){return e(t)>=0})(n)||t.push(n)},pop:function(n){var r=e(n);r<0||t.splice(r,1)}}},rn=function(t,e,n,r){return t.addEventListener(en[e],n,r)},on=function(t,e,n){return t.removeEventListener(en[e],n)},an=function(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{stopPropagation:!0,cancelOnMultiple:!1},i={x:0,y:0},a={parameters:null,enabled:!0,origin:null,cancel:!1,cancelled:!1,pointers:nn()},c=function(t,e){return e.apply(null,[function(t){return{x:t.pageX-i.x,y:t.pageY-i.y}}(t)].concat(a.parameters))},u=function(n){var r=0===a.pointers.count();r&&(a.active=!1,a.cancel=!1,a.cancelled=!1),a.pointers.push(n),rn(document.documentElement,"up",s),r?(t===n.target||t.contains(n.target))&&n.isPrimary&&(n.preventDefault(),o.stopPropagation&&(n.stopPropagation(),n.stopImmediatePropagation()),a.active=!0,i.x=n.pageX,i.y=n.pageY,rn(document.documentElement,"move",l),a.parameters=e()||[]):o.cancelOnMultiple&&(a.cancel=!0)},l=function(t){t.isPrimary&&(a.cancelled||(t.preventDefault(),c(t,n),a.cancel&&(a.cancelled=!0,c(t,r))))},s=function t(e){a.pointers.pop(e),0===a.pointers.count()&&(on(document.documentElement,"move",l),on(document.documentElement,"up",t)),a.active&&(a.cancelled||(e.preventDefault(),o.stopPropagation&&e.stopPropagation(),c(e,n),c(e,r)))};return rn(document.documentElement,"down",u),{enable:function(){a.enabled||rn(document.documentElement,"down",u),a.enabled=!0},disable:function(){a.enabled&&on(document.documentElement,"down",u),a.enabled=!1},destroy:function(){on(document.documentElement,"up",s),on(document.documentElement,"move",l),on(document.documentElement,"down",u)}}},cn={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},un=function(t,e,n,r,o){var i=null,a=!0,c={enabled:!0},u=function(t){var o=cn[t.keyCode]||t.keyCode;n[o]&&(t.stopPropagation(),a&&(i=e(o),a=!1),n[o](i),r(i))},l=function(t){var e=cn[t.keyCode]||t.keyCode;n[e]&&(t.stopPropagation(),o(i),a=!0)};return t.addEventListener("keydown",u),t.addEventListener("keyup",l),{enable:function(){c.enabled||(t.addEventListener("keydown",u),t.addEventListener("keyup",l)),c.enabled=!0},disable:function(){c.enabled&&(t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)),c.enabled=!1},destroy:function(){t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)}}},ln=V({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(t){for(var e=t.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg">',r=0;r<=180;r+=2){var o=r*(176/180)-90+2,i=r%10==0?.5:.2;if(n+='<circle fill="currentColor" cx="'.concat(o,'" cy="').concat(0,'" r="').concat(i,'"/>'),r%10==0)n+='<text fill="currentColor" x="'.concat(o+(o<0?-2.25:0===o?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+r,"°</text>")}n+="</svg>",e.element.innerHTML=n}}),sn=V({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:250,duration:500}},apis:["rotation","animate"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("tabindex",0);var r=document.createElement("button");r.innerHTML="<span>".concat(e.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),r.className="doka--crop-rotator-center",r.addEventListener("click",function(){e.dispatch("CROP_IMAGE_ROTATE_CENTER")}),e.appendChild(r);var o=null;e.appendChildView(e.createChildView(function(t,e){return V({name:t,ignoreRect:!0,create:e})}("crop-rotator-line-mask",function(t){var e=t.root,n=t.props;o=e.appendChildView(e.createChildView(ln,{translateX:Math.round(312*n.rotation)}))}),n)),e.ref.line=o;var i=document.createElement("div");i.className="doka--crop-rotator-bar",e.appendChild(i);var a=Math.PI/4,c=0;e.ref.dragger=an(i,function(){c=o.translateX/312,e.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(t){var n=t.x/e.rect.element.width*(Math.PI/2),r=vt(c+n,-a,a);e.dispatch("CROP_IMAGE_ROTATE",{value:-r})},function(){e.dispatch("CROP_IMAGE_ROTATE_RELEASE")}),e.ref.keyboard=un(e.element,function(){c=0},{left:function(){c+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},right:function(){c-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})}},function(){},function(){})},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.keyboard.destroy()},write:N({REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.disable(),e.ref.keyboard.disable()},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.enable(),e.ref.keyboard.enable()}},function(t){var e=t.root,n=t.props,r=t.timestamp,o=n.animate,i=n.rotation;o||0===i||(e.ref.line.translateX=null);var a=0,c=e.query("GET_CROP",n.id,r);if(c&&c.interaction&&c.interaction.rotation){var u=he(c.interaction.rotation).sub-i;a=.025*Math.sign(u)*Math.log10(1+Math.abs(u)/.025)}e.ref.line.translateX=Math.round(312*(-i-a))})}),fn=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},pn={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},dn=function(t,e,n,r,o){e=Math.round(e),n=Math.round(n);var i=o||document.createElement("canvas"),a=i.getContext("2d");return r>=5&&r<=8?(i.width=n,i.height=e):(i.width=e,i.height=n),a.save(),function(t,e,n,r){-1!==r&&t.transform.apply(t,pn[r](e,n))}(a,e,n,r),a.drawImage(t,0,0,e,n),a.restore(),i},hn=V({name:"subject-image",ignoreRect:!0,ignoreRectUpdate:!0,tag:"canvas",mixins:{styles:["perspective","rotateX","rotateY","rotateZ","scaleX","scaleY"],animations:{rotateX:{type:"spring",stiffness:.25,damping:.25,mass:2.5},rotateY:{type:"spring",stiffness:.25,damping:.25,mass:2.5},scaleX:{type:"spring",stiffness:.25,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.25,damping:.75,mass:15}}},write:N({DID_PRESENT_IMAGE:function(t){var e=t.root;e.scaleX=1,e.scaleY=1}}),create:function(t){var e=t.root;e.rotateZ=1e-5;var n="preview"!==e.query("GET_STYLE_LAYOUT_MODE");e.scaleX=n?1.15:1,e.scaleY=n?1.15:1,e.rotateX=n?1:null,e.rotateY=n?1:null;var r=e.query("GET_FILE"),o=URL.createObjectURL(r.data);!function(){var t=function(t){var n=ye(t,{width:e.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")});dn(t,n.width,n.height,r.orientation,e.element),e.dispatch("DID_PRESENT_IMAGE")},n=function(){Ce(o).then(t)};if(function(t){return"createImageBitmap"in window&&function(t){return/^image/.test(t.type)&&!/svg/.test(t.type)}(t)}(r.data)){var i=Pe(fn);i.post({file:r.data},function(e){i.terminate(),e?t(e):n()})}else n()}()}}),yn=V({name:"subject-image-container",tag:"div",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["flipHorizontal","flipVertical","scale"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ","opacity"],animations:{opacity:{type:"tween",delay:150,duration:750},scaleX:{type:"spring",stiffness:.5,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.5,damping:.75,mass:15},translateX:"spring",translateY:"spring",originX:"spring",originY:"spring",rotateZ:{type:"spring",stiffness:.25,damping:.25,mass:2.5}}},create:function(t){var e=t.root;e.element.setAttribute("tabindex",0),e.ref.image=e.appendChildView(e.createChildView(hn,{rotateX:0,rotateY:0,perspective:2e3})),e.ref.dragger=an(e.element,function(){e.dispatch("CROP_IMAGE_DRAG_GRAB")},function(t){e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(){e.dispatch("CROP_IMAGE_DRAG_RELEASE")},{cancelOnMultiple:!0})},destroy:function(t){t.root.ref.dragger.destroy()},write:N({REQUEST_PREPARE_OUTPUT:function(t){t.root.ref.dragger.disable()},DID_PREPARE_OUTPUT:function(t){t.root.ref.dragger.enable()}},function(t){var e=t.root,n=t.props;e.ref.image.rotateX=n.flipVertical?Math.PI:0,e.ref.image.rotateY=n.flipHorizontal?Math.PI:0})}),mn=["nw","ne","se","sw"],gn=["n","e","s","w"],vn=function(t){return gn[(gn.indexOf(t)+2)%gn.length]},En=ht()&&1===window.devicePixelRatio?function(t){return Math.round(t)}:function(t){return t},wn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),_n=function(t,e){return V({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:{type:"tween",duration:350,delay:e},scaleY:{type:"tween",duration:350,delay:e},opacity:{type:"tween",duration:350,delay:e}}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-corner"),n.element.setAttribute("role","button"),n.element.setAttribute("tabindex",-1),n.opacity=1,n.scaleX=1,n.scaleY=1,n.ref.dragger=an(n.element,function(){return n.dispatch("CROP_RECT_CORNER_DRAG_GRAB"),[t,function(t){return mn[(mn.indexOf(t)+2)%mn.length]}(t)]},function(t,e,r){n.dispatch("CROP_RECT_CORNER_DRAG",{offset:t,origin:e,anchor:r})},function(){n.dispatch("CROP_RECT_CORNER_DRAG_RELEASE")})},write:N({REQUEST_PREPARE_OUTPUT:function(t){t.root.ref.dragger.disable()},DID_PREPARE_OUTPUT:function(t){t.root.ref.dragger.enable()}}),destroy:function(t){t.root.ref.dragger.destroy()}})},bn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:250,duration:500}},apis:["rectangle","draft","rotating"]},create:function(t){var e=t.root;e.ref.wasRotating=!1,mn.forEach(function(t,n){e.ref[t]=e.appendChildView(e.createChildView(_n(t,50*(mn.length-n))))}),gn.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return V({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring"}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button"),n.ref.dragger=an(n.element,function(){return n.dispatch("CROP_RECT_EDGE_DRAG_GRAB"),[t,vn(t)]},function(t,e,r){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:t,origin:e,anchor:r})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")}),n.ref.keyboard=un(n.element,function(){return{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20}},function(e){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:e,origin:t,anchor:vn(t)})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")})},REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.disable(),e.ref.keyboard.disable()},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.dragger.enable(),e.ref.keyboard.enable()},destroy:function(t){var e=t.root;e.ref.keyboard.destroy(),e.ref.dragger.destroy()}})}(t)))}),e.ref.lines=[];for(var n=0;n<10;n++)e.ref.lines.push(e.appendChildView(e.createChildView(wn,{opacity:0})))},write:function(t){var e=t.root,n=t.props,r=n.rectangle,o=n.draft,i=n.rotating;if(r){var a=e.ref,c=a.n,u=a.e,l=a.s,s=a.w,f=a.nw,p=a.ne,d=a.se,h=a.sw,y=a.lines,m=r.x,g=r.y,v=r.x+r.width,E=r.y+r.height,w=E-g,_=v-m;if(xn(o,f,m,g),xn(o,p,v,g),xn(o,d,v,E),xn(o,h,m,E),On(o,c,m,g,_/100,1),On(o,u,v,g,1,w/100),On(o,l,m,E,_/100,1),On(o,s,m,g,1,w/100),i){e.ref.wasRotating=!0;var b=y.slice(0,5),O=1/b.length;b.forEach(function(t,e){On(o,t,m,g+w*(O+e*O),_/100,.01),t.opacity=.5});var x=y.slice(5);O=1/x.length,x.forEach(function(t,e){On(o,t,m+_*(O+e*O),g,.01,w/100),t.opacity=.5})}else if(o){e.ref.wasRotating=!1;var R=y[0],T=y[1],A=y[2],I=y[3];On(o,R,m,g+.333*w,_/100,.01),On(o,T,m,g+.666*w,_/100,.01),On(o,A,m+.333*_,g,.01,w/100),On(o,I,m+.666*_,g,.01,w/100),R.opacity=.5,T.opacity=.5,A.opacity=.5,I.opacity=.5}else{var P=y[0],M=y[1],C=y[2],S=y[3];!e.ref.wasRotating&&P.opacity>0&&(On(o,P,m,g+.333*w,_/100,.01),On(o,M,m,g+.666*w,_/100,.01),On(o,C,m+.333*_,g,.01,w/100),On(o,S,m+.666*_,g,.01,w/100)),y.forEach(function(t){return t.opacity=0})}}}}),On=function(t,e,n,r,o,i){t&&(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=En(n),e.translateY=En(r),e.scaleX=o,e.scaleY=i},xn=function(t,e,n,r){t&&(e.translateX=null,e.translateY=null),e.translateX=En(n),e.translateY=En(r)},Rn=["top","right","bottom","left"],Tn=function(t,e,n,r,o,i){t||(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=n,e.translateY=r,e.scaleX=o,e.scaleY=i},An=V({ignoreRect:!0,name:"crop-smoke",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","container","animate"]},create:function(t){var e=t.root;Rn.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-smoke-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring"}}})}(t)))})},write:function(t){var e=t.root,n=t.props,r=e.ref,o=r.top,i=r.right,a=r.bottom,c=r.left,u=n.rectangle,l=n.container,s=n.animate,f=e.rect.element,p=l,d=u.x,h=u.y,y=p.top,m=p.left,g=h+y,v=p.width,E=d+m,w=d+u.width,_=h+u.height,b=p.height-(_+y),O=m+f.width-(d+u.width);Tn(s,o,-m-2,-y-2,(v+4)/100,(g+2)/100),Tn(s,c,-m-2,h-2,(E+2)/100,(u.height+4)/100),Tn(s,i,w,h-2,(O+2)/100,(u.height+4)/100),Tn(s,a,-m-2,_,(v+4)/100,(b+2)/100)}}),In=function(t,e){if(!/svg/.test(t.namespaceURI)||"innerHTML"in t)t.innerHTML=e;else{var n=document.createElement("div");n.innerHTML="<svg>"+e+"</svg>";for(var r=n.firstChild;r.firstChild;)t.appendChild(r.firstChild)}},Pn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-mask",tag:"svg",mixins:{styles:["opacity","translateX","translateY"],animations:{maskWidth:"spring",maskHeight:"spring",scale:"spring",translateX:"spring",translateY:"spring",opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","animate","maskWidth","maskHeight","scale"]},create:function(t){var e=t.root;e.customWriter=e.query("GET_CROP_MASK")(e.element,In)||function(){}},didWriteView:function(t){var e=t.root,n=t.props,r=n.maskWidth,o=n.maskHeight,i=n.scale;e.element.setAttribute("width",En(r)),e.element.setAttribute("height",En(o));var a=e.query("GET_CROP_MASK_INSET");e.customWriter({x:i*a,y:i*a,width:r-i*a*2,height:o-i*a*2},{width:r,height:o})}}),Mn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},listeners:!0},tag:"button",create:function(t){var e=t.root,n=t.props;e.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),n.name&&n.name.split(" ").forEach(function(t){e.element.className+=" doka--button-".concat(t)}),e.ref.handleClick=function(t){"string"==typeof n.action?e.dispatch(n.action):n.action()},e.element.addEventListener("click",e.ref.handleClick),n.create&&n.create({root:e,props:n})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),Cn=function(t,e){return V({ignoreRect:!0,name:t,mixins:e,create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})},Sn=function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r),i=e.ref.btnZoom;if(i){var a=o.rectangle.limited;i.translateX=a.x+.5*a.width,i.translateY=a.y+.5*a.height}},Dn=V({name:"crop-subject",ignoreRect:!0,mixins:{apis:["overlay"],styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root;e.opacity=1,e.ref.imageView=e.appendChildView(e.createChildView(yn,{flip:{horizontal:!1,vertical:!1},translateX:null,translateY:null,rotateZ:null,scaleX:null,scaleY:null,opacity:0})),e.query("GET_CROP_MASK")&&(e.ref.maskView=e.appendChildView(e.createChildView(Pn,{opacity:0}))),e.ref.cropView=e.appendChildView(e.createChildView(bn,{opacity:0})),e.ref.overlayView=e.appendChildView(e.createChildView(An,{opacity:0})),e.query("GET_CROP_ZOOM_TIMEOUT")||(e.ref.btnZoom=e.appendChildView(e.createChildView(Cn("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:Mn,label:e.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g></svg>',action:function(){return e.dispatch("CROP_ZOOM")}}]}))),e.ref.state={size:null},e.ref.hasTroubleAnimatingTransformOrigin="safari"in window},write:N({CROP_RECT_EDGE_DRAG_RELEASE:Sn,CROP_RECT_CORNER_DRAG_RELEASE:Sn,DID_PRESENT_IMAGE:function(t){var e=t.root;e.ref.imageView.opacity=1,e.ref.cropView.opacity=1}},function(t){var e=t.root,n=t.props,r=t.actions,o=t.timestamp;if(null===e.ref.state.size){if(!e.rect.element.width)return;e.ref.state.size={width:e.rect.element.width,height:e.rect.element.height},e.dispatch("DID_RESIZE_STAGE",{size:e.ref.state.size})}else if(e.ref.state.size.width!==e.rect.element.width||e.ref.state.size.height!==e.rect.element.height){var i=e.rect.element,a=i.width,c=i.height;e.ref.state.size={width:a,height:c},e.dispatch("DID_RESIZE_STAGE",{size:e.ref.state.size})}var u=e.query("GET_CROP",n.id,o);if(u){var s=e.ref,f=s.imageView,p=s.cropView,d=s.maskView,h=s.overlayView,y=s.btnZoom,m=u.isRotating,g=u.isDraft,v=u.origin,E=u.translation,w=u.scale,_=u.rotation,b=u.rectangle,O=u.flip;h.opacity=.8,g&&(f.originX=null,f.originY=null,f.translateX=null,f.translateY=null,f.scaleX=null,f.scaleY=null,f.rotateZ=null),f.perspective=100;var x={x:0,y:0},R=0,T=0;if(g&&u.interaction){if(u.interaction.translation){var A=u.interaction.translation.x-E.x,I=u.interaction.translation.y-E.y;x={x:100*Math.sign(A)*Math.log10(1+Math.abs(A)/100),y:100*Math.sign(I)*Math.log10(1+Math.abs(I)/100)}}if(u.interaction.scale){var P=u.interaction.scale-w;R=.25*Math.sign(P)*Math.log10(1+Math.abs(P)/.25)}if(u.interaction.rotation){var M=u.interaction.rotation-(_.main+_.sub);T=.05*Math.sign(M)*Math.log10(1+Math.abs(M)/.05)}}if(e.ref.hasTroubleAnimatingTransformOrigin)!!r.find(function(t){return"CROP_IMAGE_DRAG_RELEASE"===t.type})&&(f.originX=null,f.originY=null,f.translateX=null,f.translateY=null);f.originX=v.x,f.originY=v.y,f.translateX=E.x+x.x,f.translateY=E.y+x.y,f.scaleX=w+R,f.scaleY=w+R,f.rotateZ=_.main+_.sub+T,f.flipHorizontal=O.horizontal,f.flipVertical=O.vertical,p.draft=g,p.rotating=m;var C={},S=b.free,D=Mt(S),L=Mt(b.limited);l(D,function(t){var e=D[t]-L[t];C[t]=L[t]+5*Math.sign(e)*Math.log10(1+Math.abs(e)/5)});var G={x:C.left,y:C.top,width:C.right-C.left,height:C.bottom-C.top};p.rectangle=G;var U=e.query("GET_ROOT");h.animate=!g,h.container={left:U.left+e.rect.element.left,top:U.top+e.rect.element.top,width:U.width,height:U.height},h.rectangle=G,d&&(d.opacity=1,g&&(d.translateX=null,d.translateY=null,d.maskWidth=null,d.maskHeight=null),d.translateX=En(G.x),d.translateY=En(G.y),d.maskWidth=G.width,d.maskHeight=G.height,d.scale=w),y&&(y.opacity=u.canRecenter&&!u.isDraft?1:0)}})}),Ln=function(){return performance.now()};function Gn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Un(t,e,n[e])})}return t}function Un(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var jn=function(t,e){var n=function(t,e){for(;1===t.nodeType&&!e(t);)t=t.parentNode;return 1===t.nodeType?t:null}(e,function(t){return t.classList.contains("doka--root")});return!!n&&n.contains(t)},kn=function(t){var e=t.root,n=t.props,r=t.action.position,o=n.pivotPoint,i=e.ref,a=i.indicatorA,c=i.indicatorB,u=o.x-r.x,l=o.y-r.y,s={x:o.x+u,y:o.y+l},f={x:o.x-u,y:o.y-l};a.style.cssText="transform: translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)"),c.style.cssText="transform: translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)")},Vn=function(t){return{x:t.pageX,y:t.pageY}},Nn=V({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint"]},create:function(t){var e=t.root,n=t.props;e.ref.indicatorA=document.createElement("div"),e.appendChild(e.ref.indicatorA),e.ref.indicatorB=document.createElement("div"),e.appendChild(e.ref.indicatorB);var r=e.query("GET_CROP_RESIZE_KEY_CODES"),o={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},i=Ln();e.ref.state=o;var a=nn(),c=0,u=!1;e.ref.resizeStart=function(t){if(0===a.count()&&(u=!1),a.push(t),rn(document.documentElement,"up",e.ref.resizeEnd),jn(e.element,t.target)&&a.multiple()){t.stopPropagation(),t.preventDefault();var n=a.active(),r=Vn(n[0]),o=Vn(n[1]);c=bt(r,o),rn(document.documentElement,"move",e.ref.resizeMove),u=!0}},e.ref.resizeMove=function(t){if(u&&(t.preventDefault(),2===a.count())){a.update(t);var n=a.active(),r=Vn(n[0]),o=Vn(n[1]),i=(bt(r,o)-c)/c;e.dispatch("CROP_IMAGE_RESIZE",{value:i})}},e.ref.resizeEnd=function(t){a.pop(t);var n=0===a.count();n&&(on(document.documentElement,"move",e.ref.resizeMove),on(document.documentElement,"up",e.ref.resizeEnd)),u&&(t.preventDefault(),n&&e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},rn(document.documentElement,"down",e.ref.resizeStart);var l=performance.now(),s=0,f=1,p=function(t,e){var n=null,r=null;return function(){var o=arguments;if(!r)return t.apply(null,Array.from(arguments)),void(r=Ln());clearTimeout(n),n=setTimeout(function(){Ln()-r>=e&&(t.apply(null,Array.from(o)),r=Ln())},e-(Ln()-r))}}(function(t){var n=Math.sign(t.wheelDelta||t.deltaY),r=Ln(),o=r-l;l=r,(o>750||s!==n)&&(f=1,s=n),f+=.05*n,e.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,f)}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},100);e.ref.wheel=function(t){/doka--/.test(t.target.className)&&jn(e.element,t.target)&&(t.preventDefault(),p(t))},document.addEventListener("wheel",e.ref.wheel),e.ref.move=function(t){if(o.position.x=t.pageX-e.ref.state.offsetX,o.position.y=t.pageY-e.ref.state.scrollY-e.ref.state.offsetY,o.enabled)if(jn(e.element,t.target)){"idle"===e.element.dataset.state&&e.dispatch("RESIZER_SHOW",{position:Gn({},o.position)}),t.preventDefault(),e.dispatch("RESIZER_MOVE",{position:Gn({},o.position)});var r=n.pivotPoint,a=r.x-o.position.x,u=r.y-o.position.y,l={x:r.x+a,y:r.y+u},s=Gn({},o.position);if(o.selecting){var f=(bt(l,s)-c)/c,p=performance.now();p-i>25&&(i=p,e.dispatch("CROP_IMAGE_RESIZE",{value:f}))}}else e.dispatch("RESIZER_CANCEL")},e.ref.select=function(t){if(jn(e.element,t.target)){var r=n.pivotPoint,i=r.x-o.position.x,a=r.y-o.position.y,u={x:r.x+i,y:r.y+a},l=o.position;c=bt(u,l),o.selecting=!0,o.origin.x=t.pageX,o.origin.y=t.pageY,e.dispatch("CROP_IMAGE_RESIZE_GRAB")}},e.ref.confirm=function(t){jn(e.element,t.target)&&(o.selecting=!1,e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},e.ref.blur=function(t){o.selecting=!1,o.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL")},window.addEventListener("blur",e.ref.blur),document.addEventListener("mousemove",e.ref.move),e.ref.keyDown=function(t){r.includes(t.keyCode)&&o.position&&(o.enabled=!0,document.addEventListener("mousedown",e.ref.select),document.addEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_SHOW",{position:Gn({},o.position)}))},e.ref.keyUp=function(t){r.includes(t.keyCode)&&(o.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",e.ref.keyDown),document.body.addEventListener("keyup",e.ref.keyUp)},destroy:function(t){var e=t.root;document.removeEventListener("touchmove",e.ref.resizeMove),document.removeEventListener("touchend",e.ref.resizeEnd),document.removeEventListener("touchstart",e.ref.resizeStart),document.removeEventListener("wheel",e.ref.wheel),document.removeEventListener("mousemove",e.ref.move),document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),document.body.removeEventListener("keydown",e.ref.keyDown),document.body.removeEventListener("keyup",e.ref.keyUp),window.removeEventListener("blur",e.ref.blur)},read:function(t){var e=t.root;e.ref.state.scrollY=window.scrollY;var n=e.element.getBoundingClientRect();e.ref.state.offsetX=n.x,e.ref.state.offsetY=n.y},write:N({RESIZER_SHOW:function(t){var e=t.root,n=t.props,r=t.action;e.element.dataset.state="multi-touch",kn({root:e,props:n,action:r})},RESIZER_CANCEL:function(t){t.root.element.dataset.state="idle"},RESIZER_MOVE:kn})}),Yn=V({ignoreRect:!0,name:"group",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",stiffness:.25,damping:.5,mass:5}}},create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}});function Bn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){zn(t,e,n[e])})}return t}function zn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Xn=V({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;n.options.map(function(t){var r=e.createChildView(Mn,Bn({},t,{action:function(){return e.dispatch(n.optionAction,{value:t.value})}}));return e.appendChildView(r)}),e.element.setAttribute("role","list"),e.ref.handleClick=function(){return n.action&&n.action()},e.element.addEventListener("click",e.ref.handleClick)},write:function(t){var e=t.root,n=t.props,r=(t.actions,n.options.findIndex(function(t){return t.value===n.selectedValue}));e.childViews.forEach(function(t,e){t.element.setAttribute("aria-selected",e===r)})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),qn=V({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{apis:["selectedValue"]},create:function(t){var e=t.root,n=t.props;e.ref.open=!1;var r=function(t){e.ref.open=t,e.dispatch(n.buttonAction)};e.ref.button=e.appendChildView(e.createChildView(Mn,Bn({},n,{action:function(){r(!e.ref.open)}}))),e.ref.list=e.appendChildView(e.createChildView(Xn,Bn({},n,{action:function(){r(!1)}}))),e.ref.handleBodyClick=function(t){e.element.contains(t.target)||r(!1)},e.element.addEventListener("focusin",function(t){t.target!==e.ref.button.element&&r(!0)}),e.element.addEventListener("focusout",function(t){e.element.contains(t.relatedTarget)||r(!1)}),document.body.addEventListener("click",e.ref.handleBodyClick)},destroy:function(t){var e=t.root;document.body.removeEventListener("click",e.ref.handleBodyClick)},write:function(t){var e=t.root,n=t.props;e.ref.list.opacity=e.ref.open?1:0,e.ref.list.translateY=e.ref.open?0:-5,e.ref.list.selectedValue=n.selectedValue}});function Zn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Fn(t,e,n[e])})}return t}function Fn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Hn=function(t,e){var n=t.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!e)return n[0].style.opacity=.2,n[1].style.opacity=.3,void(n[2].style.opacity=.4);n[0].style.opacity=e>1?1:.3,n[1].style.opacity=1===e?.85:.5,n[2].style.opacity=e<1?1:.3}},Wn=V({name:"crop",ignoreRect:!0,create:function(t){var e=t.root,n=t.props,r=[{view:Mn,label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_ROTATE_LEFT")}},{view:Mn,label:e.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="evenodd" class="doka--icon-flip-horizontal"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}},{view:Mn,label:e.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="doka--icon-flip-vertical"><g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_FLIP_VERTICAL")}}],o=e.query("GET_CROP_ASPECT_RATIO_OPTIONS");o&&r.push({view:qn,label:e.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="doka--icon-aspect-ratio"><g fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g></svg>',buttonAction:"TOGGLE_ASPECT_RATIO",optionAction:"CROP_SET_ASPECT_RATIO",options:o.map(function(t){return Zn({},t,{icon:function(t){var e,n;t>1?(n=14,e=Math.round(n/t)):(e=14,n=Math.round(e*t));var r=Math.round(.5*(23-e)),o=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g  fill="currentColor"><rect x="'.concat(r,'" y="').concat(o,'" width="').concat(e,'" height="').concat(n,'" rx="2.5"/></g></svg>')}(t.value)})}),didCreateView:function(t){e.ref.aspectRatioDropdown=t}}),e.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&r.splice(1,0,{view:Mn,label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g></svg>',action:function(){return e.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),e.ref.menu=e.appendChildView(e.createChildView(Yn,{className:"doka--toolbar",opacity:0,controls:r})),e.menuItemsRequiredWidth=null,e.ref.subject=e.appendChildView(e.createChildView(Dn,Zn({},n))),e.ref.rotator=e.appendChildView(e.createChildView(sn,{rotation:0,opacity:0})),e.ref.resizer=e.appendChildView(e.createChildView(Nn,{pivotPoint:{x:0,y:0}}));var i=0,a=0;e.ref.keyboard=un(e.element,function(){return i=0,a=0,{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20},plus:function(){i+=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:i}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){i-=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:i}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){a-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},right_bracket:function(){a+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:a})},h:function(){e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){e.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){e.dispatch("CROP_RESET")},r:function(){e.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){e.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){e.dispatch("CROP_ZOOM")}},function(t){t&&e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(t){t&&e.dispatch("CROP_IMAGE_DRAG_RELEASE")})},read:function(t){var e=t.root;if(null===e.menuItemsRequiredWidth){var n=e.ref.menu.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.menuItemsRequiredWidth=0===n?null:n}},write:N({REQUEST_PREPARE_OUTPUT:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=0,r.opacity=0},UNLOAD_IMAGE:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=0,r.opacity=0},DID_PREPARE_OUTPUT:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=1,r.opacity=1},TOGGLE_ASPECT_RATIO:function(t){var e=t.root,n=e.query("GET_ACTIVE_CROP_ASPECT_RATIO");Hn(e,n),e.ref.aspectRatioDropdown&&(e.ref.aspectRatioDropdown.selectedValue=n)},DID_LOAD_IMAGE:function(t){var e=t.root,n=e.query("GET_IMAGE").aspectRatio;Hn(e,e.query("GET_CROP_ASPECT_RATIO")),e.ref.aspectRatioDropdown&&(e.ref.aspectRatioDropdown.selectedValue=e.query("GET_CROP_ASPECT_RATIO")),1!==n&&function(t,e){Array.from(t.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(t){e>1&&(t.setAttribute("x",t.previousElementSibling?5:4),t.setAttribute("width",9)),e<1&&(t.setAttribute("y",11),t.setAttribute("height",10))})}(e,n)},DID_PRESENT_IMAGE:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=1,r.opacity=1}},function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r);if(o){var i=e.ref,a=i.resizer,c=i.subject,u=i.rotator,l=i.menu;a.pivotPoint={x:.5*a.rect.element.width,y:.5*a.rect.element.height},c.overlay=Zn({},e.rect),u.animate=!o.isDraft,u.rotation=o.rotation.sub,l.element.dataset.layout=e.menuItemsRequiredWidth>e.ref.menu.rect.element.width?"compact":"spacious"}})});function Qn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Kn=V({name:"content",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root;e.opacity=1,e.ref.view=null},write:N({DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.view=e.appendChildView(e.createChildView(Wn,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Qn(t,e,n[e])})}return t}({},n)))}})});function Jn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $n=function(t,e){return t.appendChildView(t.createChildView(Cn("processing-indicator",{styles:["opacity","translateY"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}}),{translateY:20,opacity:0,controls:[{view:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return V({ignoreRect:!0,tag:t,create:function(t){t.root.element.textContent=e}})}("p",e)}]}))},tr=V({name:"container",create:function(t){var e,n=t.root,r=(t.props,[(e={view:Mn,didCreateView:function(t){n.ref.btnReset=t},opacity:0,label:n.query("GET_LABEL_BUTTON_RESET")},Jn(e,"didCreateView",function(t){return n.ref.btnReset=t}),Jn(e,"name","menu menu-align-left menu-icon"),Jn(e,"icon",'<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g></svg>'),Jn(e,"action",function(){return n.dispatch("EDIT_RESET")}),e)]);n.query("GET_ALLOW_BUTTON_CANCEL")&&r.unshift({view:Mn,label:n.query("GET_LABEL_BUTTON_CANCEL"),name:"menu",opacity:0,didCreateView:function(t){n.ref.btnCancel=t},action:function(){n.dispatch("EDIT_CANCEL")}}),n.query("GET_ALLOW_BUTTON_CONFIRM")&&r.push({view:Mn,label:n.query("GET_LABEL_BUTTON_CONFIRM"),name:"menu menu-cta",opacity:0,didCreateView:function(t){n.ref.btnConfirm=t},action:function(){n.dispatch("EDIT_CONFIRM")}}),n.ref.menu=n.appendChildView(n.createChildView(Yn,{className:"doka--menu",controls:r})),1===r.length&&n.ref.menu.element.classList.add("doka--menu-collapsed"),n.ref.busyIndicators=[],n.dispatch("AWAIT_IMAGE")},write:N({DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.content=e.appendChildView(e.createChildView(Kn,{opacity:null,id:n.id})),e.ref.menu.opacity=1},UNLOAD_IMAGE:function(t){var e=t.root;t.props;e.ref.content&&(e.ref.content.opacity=0,e.ref.menu.opacity=0)},DID_UNLOAD_IMAGE:function(t){var e=t.root;e.removeChildView(e.ref.content),e.ref.content=null},AWAITING_IMAGE:function(t){var e=t.root;if(!e.rect.element.hidden){var n=$n(e,e.query("GET_LABEL_STATUS_AWAITING_IMAGE"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1}},DID_LOAD_IMAGE_ERROR:function(t){var e=t.root,n=$n(e,e.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root,n=$n(e,e.query("GET_LABEL_STATUS_LOADING_IMAGE"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1},REQUEST_PREPARE_OUTPUT:function(t){var e=t.root,n=$n(e,e.query("GET_LABEL_STATUS_PROCESSING_IMAGE"));e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.busyIndicators.push(n),n.translateY=0,n.opacity=1,e.ref.menu.opacity=0},DID_PREPARE_OUTPUT:function(t){var e=t.root;e.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0}),e.ref.menu.opacity=1},DID_PRESENT_IMAGE:function(t){var e=t.root;e.ref.busyIndicators.forEach(function(t){t.opacity=0});var n=e.ref,r=n.btnConfirm,o=n.btnCancel;r&&(r.opacity=1),o&&(o.opacity=1)}},function(t){var e=t.root,n=t.props,r=t.timestamp,o=e.query("GET_CROP",n.id,r);o&&(e.ref.btnReset.opacity=o.canReset?1:0,e.ref.content&&0===e.ref.content.opacity&&e.dispatch("DID_UNLOAD_IMAGE"))})});function er(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var nr=function(t){return t.preventDefault()},rr=V({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(t){var e=t.root,n=t.props;n.markedForRemoval=!1,e.element.addEventListener("touchmove",nr,{passive:!1}),e.element.addEventListener("gesturestart",nr),e.ref.pointerPolyfill=function(t){var e={destroy:function(){}};if("onpointerdown"in window)return e;var n=0,r=[],o=function(t,e,n){var r=new UIEvent(e.type,{view:window,bubbles:!n});Object.keys(e).forEach(function(t){Object.defineProperty(r,t,{value:e[t],writable:!1})}),t.dispatchEvent(r)},i=function(t,e,i){return Array.from(e.changedTouches).map(function(a){var c=r[a.identifier],u={type:t,pageX:a.pageX,pageY:a.pageY,pointerId:a.identifier,isPrimary:c?c.isPrimary:0===n,preventDefault:function(){return e.preventDefault()}};return o(a.target,u,i),u})},a=function(t){i("pointerdown",t).forEach(function(t){r[t.pointerId]=t,n++})},c=function(t){i("pointermove",t)},u=function(t){i("pointerup",t).forEach(function(t){delete r[t.pointerId],n--})},l=function(t,e,n){var r={type:t,pageX:e.pageX,pageY:e.pageY,pointerId:0,isPrimary:!0,preventDefault:function(){return e.preventDefault()}};return o(e.target,r,n),r},s=function(t){l("pointerdown",t)},f=function(t){l("pointermove",t)},p=function(t){l("pointerup",t)};return"ontouchstart"in window?(t.addEventListener("touchstart",a),t.addEventListener("touchmove",c),t.addEventListener("touchend",u)):"onmousedown"in window&&(t.addEventListener("mousedown",s),t.addEventListener("mousemove",f),t.addEventListener("mouseup",p)),e.destroy=function(){r.length=0,t.removeEventListener("touchstart",a),t.removeEventListener("touchmove",c),t.removeEventListener("touchend",u),t.removeEventListener("mousedown",s),t.removeEventListener("mousemove",f),t.removeEventListener("mouseup",p)},e}(e.element),e.appendChildView(e.createChildView(tr,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){er(t,e,n[e])})}return t}({},n)))},destroy:function(t){var e=t.root;e.ref.pointerPolyfill.destroy(),e.element.removeEventListener("touchmove",nr,!0),e.element.removeEventListener("gesturestart",nr)}});function or(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ir=function(){function t(){e.fire("touch-detected"),window.removeEventListener("touchstart",t,!1)}var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){or(t,e,n[e])})}return t}({},it(),{destroy:function(){window.removeEventListener("touchstart",t,!1)}});return window.addEventListener("touchstart",t,!1),e};function ar(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var cr=function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ar(t,e,n[e])})}return t}({},it(),{destroy:function(){t.removeEventListener("dragover",n),t.removeEventListener("drop",r)}}),n=function(t){return t.preventDefault()},r=function(t){t.preventDefault();var n=Array.from(t.dataTransfer.items||t.dataTransfer.files).map(function(t){return t.getAsFile&&"file"===t.kind?t.getAsFile():t});e.fire("drop",n)};return t.addEventListener("dragover",n),t.addEventListener("drop",r),e},ur=function(t){var e=t.query("GET_STYLE_LAYOUT_MODE");return/fullscreen/.test(e)},lr=function(t){var e=t.query("GET_STYLE_LAYOUT_MODE");return/fullscreen|preview/.test(e)},sr=function(t){return t.query("GET_ALLOW_AUTO_CLOSE")},fr=lr,pr=lr,dr=function(t){var e=t.element,n=t.ref,r=n.handleFullscreenUpdate,o=n.handleTrapFocus,i=n.handleEscapeKey;e.removeAttribute("tabindex"),e.removeEventListener("keydown",o),e.removeEventListener("keydown",i),window.removeEventListener("resize",r),document.body.classList.remove("doka--parent")},hr=V({name:"root",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(t){var e=t.root,n=t.props;e.element.id=e.query("GET_ID")||"doka-".concat(n.id),e.ref.environment=[],e.ref.shouldBeDestroyed=!1,e.ref.isClosing=!1,e.ref.isClosed=!1,e.query("GET_ALLOW_DROP_FILES")&&(e.ref.catcher=cr(e.element),e.ref.catcher.on("drop",function(t){t.forEach(function(t){e.dispatch("REQUEST_LOAD_IMAGE",{source:t})})})),e.ref.touchDetector=ir(),e.ref.touchDetector.onOnce("touch-detected",function(){e.ref.environment.push("touch")}),e.ref.editor=e.appendChildView(e.createChildView(rr,{id:n.id})),e.query("GET_STYLES").filter(function(t){return!B(t.value)}).map(function(t){var n=t.name,r=t.value;e.element.dataset[n]=r}),e.ref.updateViewport=function(){e.dispatch("UPDATE_VIEWPORT")},window.addEventListener("resize",e.ref.updateViewport),e.element.dataset.styleViewport=yr(e.rect.element.width,e.rect.element.height)+" "+e.ref.environment.join(" ");var r=document.createElement("div");r.style.cssText="position:fixed;height:100vh;top:0;",e.ref.measure=r,document.body.appendChild(r),e.ref.handleEscapeKey=function(t){27===t.keyCode&&e.dispatch("EDIT_CANCEL")},e.ref.handleTrapFocus=function(t){if(9===t.keyCode){var n=Array.from(e.element.querySelectorAll("button,[tabindex]")).filter(function(t){return"hidden"!==t.style.visibility}),r=n[0],o=n[n.length-1];t.shiftKey?document.activeElement===r&&(o.focus(),t.preventDefault()):document.activeElement===o&&(r.focus(),t.preventDefault())}},e.ref.initialScreenMeasureHeight=null,e.ref.handleFullscreenUpdate=function(){e.element.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight}},write:N({ENTER_FULLSCREEN:function(t){!function(t){var e=t.element,n=t.ref,r=n.handleFullscreenUpdate,o=n.handleTrapFocus,i=n.handleEscapeKey;e.setAttribute("tabindex",-1),r(),e.addEventListener("keydown",o),e.addEventListener("keydown",i),window.addEventListener("resize",r),document.body.classList.add("doka--parent"),document.body.appendChild(e),t.opacity=1,t.element.contains(document.activeElement)||e.focus(),t.dispatch("UPDATE_VIEWPORT")}(t.root)},EXIT_FULLSCREEN:function(t){var e=t.root;dr(e)},DID_SET_STYLE_LAYOUT_MODE:function(t){var e=t.root,n=t.action;e.element.dataset.styleLayoutMode=n.value||"none",/fullscreen/.test(n.value)&&!/fullscreen/.test(n.prevValue)&&e.dispatch("ENTER_FULLSCREEN")},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root;0===e.opacity&&(e.opacity=1),e.ref.isClosing=!1,e.ref.isClosed=!1;var n=e.query("GET_STYLE_LAYOUT_MODE");null!==n&&"modal"!==n||e.element.parentNode||e.dispatch("SET_STYLE_LAYOUT_MODE",{value:("fullscreen "+(n||"")).trim()})},UPDATE_VIEWPORT:function(t){var e=t.root;e.dispatch("DID_UPDATE_VIEWPORT",{rect:{left:e.ref.editor.rect.element.left,top:e.ref.editor.rect.element.top,width:e.rect.element.width,height:e.rect.element.height}})},DID_CANCEL:function(t){var e=t.root;fr(e)&&sr(e)&&e.dispatch("EDIT_CLOSE")},DID_CONFIRM:function(t){var e=t.root;fr(e)&&sr(e)&&e.dispatch("EDIT_CLOSE")},EDIT_CLOSE:function(t){var e=t.root;pr(e)&&(e.opacity=e.opacity||1,e.opacity=0,e.ref.isClosed=!1,e.ref.isClosing=!0,e.query("GET_ALLOW_AUTO_DESTROY")&&(e.ref.shouldBeDestroyed=!0),ur(e)&&e.dispatch("EXIT_FULLSCREEN"))}},function(t){var e=t.root;t.actions;e.element.dataset.styleViewport=yr(e.rect.element.width,e.rect.element.height)+" "+e.ref.environment.join(" "),e.query("GET_ROOT")||e.dispatch("UPDATE_VIEWPORT")}),didWriteView:function(t){var e=t.root,n=e.ref,r=n.isClosed,o=n.isClosing,i=n.shouldBeDestroyed;!r&&o&&0===e.opacity&&(e.dispatch("DID_CLOSE"),e.ref.isClosed=!0,e.ref.isClosing=!1,i&&e.dispatch("EDIT_DESTROY"))},read:function(t){var e=t.root,n=e.ref.measure;n&&(e.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),e.ref.measure=null)},destroy:function(t){var e=t.root;ur(e)&&(dr(e),document.body.removeChild(e.element)),window.removeEventListener("resize",e.ref.updateViewport),e.ref.touchDetector.destroy(),e.ref.catcher&&e.ref.catcher.destroy()}}),yr=function(t,e){var n="";return 0===t&&0===e?"detached":(n+=e>t?"portrait":"landscape",(n+=t<=600?" x-cramped":t<=1e3?" x-comfortable":" x-spacious").trim())};function mr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){gr(t,e,n[e])})}return t}function gr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vr=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=mt(),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=i({},t),o=[],a=[],c=function(t,e,n){n?a.push({type:t,data:e}):(f[t]&&f[t](e),o.push({type:t,data:e}))},u=function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return s[t]?(e=s)[t].apply(e,r):null},l={getState:function(){return i({},r)},processActionQueue:function(){var t=o.concat();return o.length=0,t},processDispatchQueue:function(){var t=a.concat();a.length=0,t.forEach(function(t){var e=t.type,n=t.data;c(e,n)})},dispatch:c,query:u},s={};e.forEach(function(t){s=i({},t(r),s)});var f={};return n.forEach(function(t){f=i({},t(c,u,r),f)}),l}(function(t){var e={noImageTimeout:null,options:et(t)};return nt(e),e}(e),[Nt,function(t){return function(e){var n={};return l(t,function(t){n["GET_".concat(rt(t,"_").toUpperCase())]=function(n){return e.options[t]}}),n}}(e)],[tn,function(t){return function(e,n,r){var o={};return l(t,function(t){var n=rt(t,"_").toUpperCase();o["SET_".concat(n)]=function(o){var i;try{i=r.options[t],r.options[t]=o.value}catch(t){}e("DID_SET_".concat(n),{value:r.options[t],prevValue:i})}}),o}}(e)]);n.dispatch("SET_OPTIONS",{options:t});var a=ot(),c=null,u=hr(n,{id:a}),f=!1,p={_read:function(){f||u._read()},_write:function(t){var e=n.processActionQueue().filter(function(t){return!/^SET_/.test(t.type)});f&&!e.length||(y(e),(f=u._write(t,e))&&n.processDispatchQueue(),e.find(function(t){return"EDIT_DESTROY"===t.type})&&m())}},d=function(t){return function(e){var n={type:t};return e?(n.output=e.output,e.hasOwnProperty("error")&&(n.error=e.error?mr({},e.error):null),n):n}},h={DID_CONFIRM:d("confirm"),DID_CANCEL:d("cancel"),DID_LOAD_IMAGE:d("load"),DID_CLOSE:d("close"),DID_DESTROY:d("destroy"),DID_INIT:d("init")},y=function(t){t.length&&t.forEach(function(t){if(h[t.type]){var e=h[t.type];(Array.isArray(e)?e:[e]).forEach(function(e){setTimeout(function(){!function(t){var e=mr({doka:g},t);delete e.type,u&&u.element.dispatchEvent(new CustomEvent("Doka:".concat(t.type),{detail:e,bubbles:!0,cancelable:!0,composed:!0}));var r=[];t.hasOwnProperty("error")&&r.push(t.error);var o=["type","error"];Object.keys(t).filter(function(t){return!o.includes(t)}).forEach(function(e){return r.push(t[e])}),g.fire.apply(g,[t.type].concat(r));var i=n.query("GET_ON".concat(t.type.toUpperCase()));i&&i.apply(void 0,r)}(e(t.data))},0)})}})},m=function(){g.fire("destroy",u.element),u._destroy(),n.dispatch("DID_DESTROY")},g=mr({},it(),p,function(t,e){var n={};return l(e,function(e){n[e]={get:function(){return t.getState().options[e]},set:function(n){t.dispatch("SET_".concat(rt(e,"_").toUpperCase()),{value:n})}}}),n}(n,e),{setOptions:function(t){return n.dispatch("SET_OPTIONS",{options:t})},setData:function(t){n.dispatch("SET_DATA",t)},getData:function(t){return new Promise(function(e,r){n.dispatch("GET_DATA",mr({},t,{success:e,failure:r}))})},open:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,o){t&&n.dispatch("REQUEST_LOAD_IMAGE",{source:t,options:e,success:r,failure:o,resolveOnConfirm:!!e&&e.resolveOnConfirm})})},edit:function(t,e){return g.open(t,mr({},e,{resolveOnConfirm:!0}))},save:function(t){return new Promise(function(e,r){n.dispatch("GET_DATA",mr({},t,{success:e,failure:r}))})},clear:function(){return n.dispatch("REQUEST_REMOVE_IMAGE")},close:function(){return n.dispatch("EDIT_CLOSE")},destroy:m,insertBefore:function(t){r(u.element,t)},insertAfter:function(t){o(u.element,t)},appendTo:function(t){t.appendChild(u.element)},replaceElement:function(t){r(u.element,t),t.parentNode.removeChild(t),c=t},restoreElement:function(){c&&(o(c,u.element),u.element.parentNode.removeChild(u.element),c=null)},isAttachedTo:function(t){return!!u&&(u.element===t||c===t)},element:{get:function(){return u?u.element:null}}});return n.dispatch("DID_INIT"),s(g)};function Er(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var wr=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};return l(mt(),function(t,n){e[t]=n[0]}),vr(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Er(t,e,n[e])})}return t}({},e,t))};function _r(t){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var br=function(t){return"object"===_r(t)&&null!==t},Or=function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.replace(new RegExp("".concat(e,"."),"g"),function(t){return t.charAt(1).toUpperCase()})}(t.replace(/^data-/,""))},xr=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];l(t.attributes,function(e){return n.push(t.attributes[e])});var r=n.filter(function(t){return t.name}).reduce(function(e,n){var r=f(t,n.name);return e[Or(n.name)]=r===n.name||r,e},{});return function t(e,n){l(n,function(n,r){l(e,function(t,o){var i=new RegExp(n);if(i.test(t)&&(delete e[t],!1!==r))if(Z(r))e[r]=o;else{var a=r.group;br(r)&&!e[a]&&(e[a]={}),e[a][function(t){return t.charAt(0).toLowerCase()+t.slice(1)}(t.replace(i,""))]=o}}),r.mapping&&t(e[r.group],r.mapping)})}(r,e),r};function Rr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Tr=function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Rr(t,e,n[e])})}return t}({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=xr(t,{"^class$":"className"});Object.keys(n).forEach(function(t){br(n[t])?(br(e[t])||(e[t]={}),Object.assign(e[t],n[t])):e[t]=n[t]}),"CANVAS"!==t.nodeName&&"IMG"!==t.nodeName||(e.src=t.dataset.dokaSrc?t.dataset.dokaSrc:t);var r=wr(e);return r.replaceElement(t),r};function Ar(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Ir=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return t instanceof HTMLElement}(e[0])?Tr.apply(void 0,e):wr.apply(void 0,Ar(e.filter(function(t){return t})))},Pr=["fire","_read","_write"],Mr=function(t){var e={};return function(t,e,n){Object.getOwnPropertyNames(t).filter(function(t){return!n.includes(t)}).forEach(function(n){return Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}(t,e,Pr),e};n.d(e,"supported",function(){return Cr}),n.d(e,"OptionTypes",function(){return Lr}),n.d(e,"create",function(){return Gr}),n.d(e,"destroy",function(){return Ur}),n.d(e,"parse",function(){return jr}),n.d(e,"find",function(){return kr}),n.d(e,"getOptions",function(){return Vr}),n.d(e,"setOptions",function(){return Nr});var Cr=function(){var t=ht()&&!("[object OperaMini]"===Object.prototype.toString.call(window.operamini))&&"visibilityState"in document&&"Promise"in window&&"slice"in Blob.prototype&&"URL"in window&&"createObjectURL"in window.URL&&"performance"in window;return function(){return t}}(),Sr={apps:[]},Dr=function(){},Lr={},Gr=Dr,Ur=Dr,jr=Dr,kr=Dr,Vr=Dr,Nr=Dr;if(Cr()){!function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,r="__framePainter";if(window[r])return window[r].readers.push(t),void window[r].writers.push(e);window[r]={readers:[t],writers:[e]};var o=window[r],i=1e3/n,a=null,c=null;(function t(e){c=window.requestAnimationFrame(t),a||(a=e);var n=e-a;n<=i||(a=e-n%i,o.readers.forEach(function(t){return t()}),o.writers.forEach(function(t){return t(e)}))})(performance.now())}(function(){Sr.apps.forEach(function(t){return t._read()})},function(t){Sr.apps.forEach(function(e){return e._write(t)})});var Yr=function t(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:Cr,create:Gr,destroy:Ur,parse:jr,find:kr,setOptions:Nr}})),document.removeEventListener("DOMContentLoaded",t)};"loading"!==document.readyState?setTimeout(function(){return Yr()},0):document.addEventListener("DOMContentLoaded",Yr);Lr={},l(mt(),function(t,e){Lr[t]=e[1]}),Gr=function(){var t=Ir.apply(void 0,arguments);return t.on("destroy",Ur),Sr.apps.push(t),Mr(t)},Ur=function(t){var e=Sr.apps.findIndex(function(e){return e.isAttachedTo(t)});return e>=0&&(Sr.apps.splice(e,1)[0].restoreElement(),!0)},jr=function(t){return Array.from(t.querySelectorAll(".".concat("doka"))).filter(function(t){return!Sr.apps.find(function(e){return e.isAttachedTo(t)})}).map(function(t){return Gr(t)})},kr=function(t){var e=Sr.apps.find(function(e){return e.isAttachedTo(t)});return e?Mr(e):null},Vr=function(){var t={};return l(mt(),function(e,n){t[e]=n[0]}),t},Nr=function(t){return br(t)&&(Sr.apps.forEach(function(e){e.setOptions(t)}),function(t){l(t,function(t,e){gt[t]&&(gt[t][0]=tt(e,gt[t][0],gt[t][1]))})}(t)),Vr()}}}])});